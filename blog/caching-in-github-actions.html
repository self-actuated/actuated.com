<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="theme-color" content="#000000"/><meta name="author" content="OpenFaaS Ltd"/><meta name="twitter:card" content="summary_large_image"/><title>Make your builds run faster with Caching for GitHub Actions</title><meta name="description" content="Learn how we made a Golang project build 4x faster using GitHub&#x27;s built-in caching mechanism."/><meta property="twitter:title" content="Make your builds run faster with Caching for GitHub Actions"/><meta property="twitter:description" content="Learn how we made a Golang project build 4x faster using GitHub&#x27;s built-in caching mechanism."/><meta property="og:title" content="Make your builds run faster with Caching for GitHub Actions"/><meta property="og:description" content="Learn how we made a Golang project build 4x faster using GitHub&#x27;s built-in caching mechanism."/><meta name="twitter:image:src" content="https://actuated.dev/images/2023-02-10-caching-in-github-actions/background.png"/><meta property="og:image" content="https://actuated.dev/images/2023-02-10-caching-in-github-actions/background.png"/><meta name="next-head-count" content="13"/><meta charSet="utf-8"/><link rel="icon" type="image/png" href="/images/actuated.png"/><link rel="stylesheet" href="https://rsms.me/inter/inter.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css"/><link rel="manifest" href="/manifest.json"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-M5YNDNX7VT"></script><script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-M5YNDNX7VT');
          </script><link rel="apple-touch-icon" href="/images/actuated.png"/><link rel="preload" href="/_next/static/css/15b65ea57c2b2cf2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/15b65ea57c2b2cf2.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-34e2100d07ae5757.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9eaa0e4bc2cfcc69.js" defer=""></script><script src="/_next/static/chunks/552-542f150c917a7625.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-109b0d2eddac75b5.js" defer=""></script><script src="/_next/static/H80v9ngO5xiHZEUgl-aga/_buildManifest.js" defer=""></script><script src="/_next/static/H80v9ngO5xiHZEUgl-aga/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-white"><header><div class="relative bg-white" data-headlessui-state=""><div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-6 sm:px-6 md:justify-start md:space-x-10 lg:px-8"><div class="flex justify-start lg:w-0 lg:flex-1"><a href="/"><span class="sr-only">Actuated</span><img class="h-8 w-auto sm:h-10" src="/images/actuated.png" alt="Actuated logo"/></a></div><div class="-my-2 -mr-2 md:hidden"><button class="inline-flex items-center justify-center rounded-md bg-white p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" type="button" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open menu</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button></div><nav class="hidden space-x-10 md:flex"><div class="relative" data-headlessui-state=""><button class="text-gray-500 group inline-flex items-center rounded-md bg-white text-base font-medium hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" type="button" aria-expanded="false" data-headlessui-state=""><span>Solutions</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd"></path></svg></button></div><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/blog">Blog</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="https://actuated.dev/blog/blazing-fast-ci-with-microvms">Announcement</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="https://docs.actuated.dev/">Docs</a></nav><div class="hidden items-center justify-end md:flex md:flex-1 lg:w-0"><a href="https://dashboard.actuated.dev" class="whitespace-nowrap text-base font-medium text-gray-500 hover:text-gray-900">Sign in</a><a href="https://docs.actuated.dev/register/" class="ml-8 inline-flex items-center justify-center whitespace-nowrap rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700">Sign up</a></div></div></div></header><main><div class="container mx-auto max-w-4xl bg-white mt-4 px-4 sm:px-6"><h1 id="post_title" class="text-3xl mb-3 leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl sm:leading-10 text-center">Make your builds run faster with Caching for GitHub Actions</h1></div><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl"><div class="border-b border-gray-200 py-4 flex items-center text-gray-500 mx-auto"><div><img class="h-10 w-10 rounded-full" src="/images/welteki.jpg" alt=""/></div><div class="ml-3"><p id="post_author" class="text-sm leading-5 font-medium text-gray-900">Han Verstraete</p><div class="flex text-sm leading-5 text-gray-500"><time dateTime="2023-02-10" id="post_date">February 10, 2023</time><span class="mx-1"></span></div></div></div><div class="mt-6 prose sm:prose-lg max-w-none"><p id="post_description" class="mb-4">Learn how we made a Golang project build 4x faster using GitHub&#x27;s built-in caching mechanism.</p></div><div id="post_content" class="mt-6 prose sm:prose-lg max-w-none"><p>GitHub provides a <a href="https://github.com/actions/cache">cache action</a> that allows caching dependencies and build outputs to improve workflow execution time.</p>
<p>A common use case would be to cache packages and dependencies from tools such as npm, pip, Gradle, ... . If you are using Go, caching go modules and the build cache can save you a significant amount of build time as we will see in the next section.</p>
<p>Caching can be configured manually, but a lot of setup actions already use the <a href="https://github.com/actions/cache">actions/cache</a> under the hood and provide a configuration option to enable caching.</p>
<p>We use the actions cache to speed up workflows for building the Actuated base images. As part of those workflows we build a kernel and then a rootfs. Since the kernelâ€™s configuration is changed infrequently it makes sense to cache that output.</p>
<p><img src="/images/2023-02-10-caching-in-github-actions/build-time-comparison.png" alt="Build time comparison"></p>
<blockquote>
<p>Comparing workflow execution times with and without caching.</p>
</blockquote>
<p>Building the kernel takes around <code>1m20s</code> on our aarch-64 Actuated runner and <code>4m10s</code> for the x86-64 build so we get some significant time improvements by caching the kernel.</p>
<p>The output of the cache action can also be used to do something based on whether there was a cache hit or miss. We use this to skip the kernel publishing step when there was a cache hit.</p>
<pre><code class="hljs language-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">if:</span> <span class="hljs-string">${{</span> <span class="hljs-string">steps.cache-kernel.outputs.cache-hit</span> <span class="hljs-type">!=</span> <span class="hljs-string">'true'</span> <span class="hljs-string">}}</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">Publish</span> <span class="hljs-string">Kernel</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">make</span> <span class="hljs-string">publish-kernel-x86-64</span>
</code></pre>
<h2>Caching Go dependency files and build outputs</h2>
<p>In this minimal example we are going to setup caching for Go dependency files and build outputs. As an example we will be building <a href="https://github.com/alexellis/registry-creds">alexellis/registry-creds</a>. This is a Kubernetes operator that can be used to replicate Kubernetes ImagePullSecrets to all namespaces.</p>
<p>It has the K8s API as a dependency which is quite large so we expect to save some time by cashing the Go mod download. By also caching the Go build cache it should be possible to speed up the workflow even more.</p>
<h3>Configure caching manually</h3>
<p>We will first create the workflow and run it without any caching.</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">ci</span>

<span class="hljs-attr">on:</span> <span class="hljs-string">push</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">repository:</span> <span class="hljs-string">"alexellis/registry-creds"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Golang</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-go@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">go-version:</span> <span class="hljs-string">~1.19</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          CGO_ENABLED=0 GO111MODULE=on \
          go build -ldflags "-s -w -X main.Release=dev -X main.SHA=dev" -o controller
</span></code></pre>
<p>The <a href="https://github.com/actions/checkout">checkout action</a> is used to check out the registry-creds repo so the workflow can access it. The next step sets up Go using the <a href="https://github.com/actions/setup-go">setup-go action</a> and as a last step we run <code>go build</code>.</p>
<p><img src="/images/2023-02-10-caching-in-github-actions/no-cache-workflow.png" alt="No cache workflow run"></p>
<p>When triggering this workflow we see that each run takes around <code>1m20s</code>.</p>
<p>Modify the workflow and add an additional step to configure the caches using the <a href="https://github.com/actions/cache">cache action</a>:</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">steps:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Golang</span>
    <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-go@v3</span>
    <span class="hljs-attr">with:</span>
      <span class="hljs-attr">go-version:</span> <span class="hljs-string">~1.19</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Golang</span> <span class="hljs-string">caches</span>
    <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/cache@v3</span>
    <span class="hljs-attr">with:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">|
        ~/.cache/go-build
        ~/go/pkg/mod
</span>      <span class="hljs-attr">key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">runner.os</span> <span class="hljs-string">}}-golang-${{</span> <span class="hljs-string">hashFiles('**/go.sum')</span> <span class="hljs-string">}}</span>
      <span class="hljs-attr">restore-keys:</span> <span class="hljs-string">|
        ${{ runner.os }}-golang-
</span></code></pre>
<p>The <code>path</code> parameter is used to set the paths on the runner to cache or restore. The <code>key</code> parameter sets the key used when saving the cache. A hash of the go.sum file is used as part of the cache key.</p>
<p>Optionally the restore-keys are used to find and restore a cache if there was no hit for the key. In this case we always restore the cache even if there was no specific hit for the go.sum file.</p>
<p>The first time this workflow is run the cache is not populated so we see a similar execution time as without any cache of around <code>1m20s</code>.</p>
<p><img src="/images/2023-02-10-caching-in-github-actions/workflow-cache-comparison.png" alt="Comparing workflow runs"></p>
<p>Running the workflow again we can see that it now completes in just <code>18s</code>.</p>
<h3>Use setup-go built-in caching</h3>
<p>The V3 edition of the <a href="https://github.com/actions/setup-go">setup-go</a> action has support for caching built-in. Under the hood it also uses the <a href="https://github.com/actions/cache">actions/cache</a> with a similar configuration as in the example above.</p>
<p>The advantage of using the built-in functionality is that it requires less configuration settings. Caching can be enabled by adding a single line to the workflow configuration:</p>
<pre><code class="hljs language-diff">name: ci

on: push

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          repository: "alexellis/registry-creds"
      - name: Setup Golang
        uses: actions/setup-go@v3
        with:
          go-version: ~1.19
<span class="hljs-addition">+         cache: true</span>
      - name: Build
        run: |
          CGO_ENABLED=0 GO111MODULE=on \
          go build -ldflags "-s -w -X main.Release=dev -X main.SHA=dev" -o controller
</code></pre>
<p>Triggering the workflow with the build-in cache yields similar time gains as with the manual cache configuration.</p>
<h2>Conclusion</h2>
<p>We walked you through a short example to show you how to set up caching for a Go project and managed to build the project 4x faster.</p>
<p>If you are building with Docker you can use <a href="https://docs.docker.com/build/ci/github-actions/examples/#cache">Docker layer caching</a> to make your builds faster. Buildkit automatically caches the build results and allows exporting the cache to an external location. It has support for <a href="https://docs.docker.com/build/cache/backends/">uploading the build cache to GitHub Actions cache</a></p>
<p>See also: <a href="https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows">GitHub: Caching dependencies in Workflows</a></p>
<p>Keep in mind that there are some limitations to the GitHub Actions cache. Cache entries that have not been accessed in over 7 days will be removed. There is also a limit on the total cache size of 10 GB per repository.</p>
<p>Some points to take away:</p>
<ul>
<li>Using the actions cache is not limited to GitHub hosted runners but can be used with self-hosted runners as well.</li>
<li>Workflows using the cache action can be converted to run on Actuated runners without any modifications.</li>
<li>Jobs on Actuated runners start in a clean VM each time. This means dependencies need to be downloaded and build artifacts or caches rebuilt each time. Caching these files in the actions cache can improve workflow execution time.</li>
</ul>
<blockquote>
<p>Want to learn more about Go and GitHub Actions?</p>
<p>Alex's eBook <a href="https://openfaas.gumroad.com/l/everyday-golang">Everyday Golang</a> has a chapter dedicated to building Go programs with Docker and GitHub Actions.</p>
</blockquote></div></div></main><footer class="bg-white"><div class="mx-auto max-w-7xl py-12 px-4 sm:px-6 md:flex md:items-center md:justify-between lg:px-8"><div class="flex justify-center space-x-6 md:order-2"><a class="text-gray-400 hover:text-gray-500" href="https://twitter.com/self-actuated"><span class="sr-only">Twitter</span><svg fill="currentColor" viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg></a><a class="text-gray-400 hover:text-gray-500" href="https://github.com/self-actuated"><span class="sr-only">GitHub</span><svg fill="currentColor" viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg></a><a class="text-gray-400 hover:text-gray-500" href="/rss.xml"><span class="sr-only">RSS</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"></path></svg></a></div><div class="mt-8 md:order-1 md:mt-0"><p class="text-center text-base text-gray-400">Â© 2022 <a href="https://openfaas.com">OpenFaaS Ltd</a>, Inc. All rights reserved.</p></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"caching-in-github-actions","fileName":"2023-02-10-caching-in-github-actions.md","contentHtml":"\u003cp\u003eGitHub provides a \u003ca href=\"https://github.com/actions/cache\"\u003ecache action\u003c/a\u003e that allows caching dependencies and build outputs to improve workflow execution time.\u003c/p\u003e\n\u003cp\u003eA common use case would be to cache packages and dependencies from tools such as npm, pip, Gradle, ... . If you are using Go, caching go modules and the build cache can save you a significant amount of build time as we will see in the next section.\u003c/p\u003e\n\u003cp\u003eCaching can be configured manually, but a lot of setup actions already use the \u003ca href=\"https://github.com/actions/cache\"\u003eactions/cache\u003c/a\u003e under the hood and provide a configuration option to enable caching.\u003c/p\u003e\n\u003cp\u003eWe use the actions cache to speed up workflows for building the Actuated base images. As part of those workflows we build a kernel and then a rootfs. Since the kernelâ€™s configuration is changed infrequently it makes sense to cache that output.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2023-02-10-caching-in-github-actions/build-time-comparison.png\" alt=\"Build time comparison\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eComparing workflow execution times with and without caching.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eBuilding the kernel takes around \u003ccode\u003e1m20s\u003c/code\u003e on our aarch-64 Actuated runner and \u003ccode\u003e4m10s\u003c/code\u003e for the x86-64 build so we get some significant time improvements by caching the kernel.\u003c/p\u003e\n\u003cp\u003eThe output of the cache action can also be used to do something based on whether there was a cache hit or miss. We use this to skip the kernel publishing step when there was a cache hit.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eif:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esteps.cache-kernel.outputs.cache-hit\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003e!=\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'true'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePublish\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eKernel\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emake\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epublish-kernel-x86-64\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eCaching Go dependency files and build outputs\u003c/h2\u003e\n\u003cp\u003eIn this minimal example we are going to setup caching for Go dependency files and build outputs. As an example we will be building \u003ca href=\"https://github.com/alexellis/registry-creds\"\u003ealexellis/registry-creds\u003c/a\u003e. This is a Kubernetes operator that can be used to replicate Kubernetes ImagePullSecrets to all namespaces.\u003c/p\u003e\n\u003cp\u003eIt has the K8s API as a dependency which is quite large so we expect to save some time by cashing the Go mod download. By also caching the Go build cache it should be possible to speed up the workflow even more.\u003c/p\u003e\n\u003ch3\u003eConfigure caching manually\u003c/h3\u003e\n\u003cp\u003eWe will first create the workflow and run it without any caching.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eci\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003eon:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epush\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003ejobs:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu-latest\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/checkout@v3\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003erepository:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"alexellis/registry-creds\"\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSetup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eGolang\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/setup-go@v3\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ego-version:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e~1.19\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBuild\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\n          CGO_ENABLED=0 GO111MODULE=on \\\n          go build -ldflags \"-s -w -X main.Release=dev -X main.SHA=dev\" -o controller\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ca href=\"https://github.com/actions/checkout\"\u003echeckout action\u003c/a\u003e is used to check out the registry-creds repo so the workflow can access it. The next step sets up Go using the \u003ca href=\"https://github.com/actions/setup-go\"\u003esetup-go action\u003c/a\u003e and as a last step we run \u003ccode\u003ego build\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2023-02-10-caching-in-github-actions/no-cache-workflow.png\" alt=\"No cache workflow run\"\u003e\u003c/p\u003e\n\u003cp\u003eWhen triggering this workflow we see that each run takes around \u003ccode\u003e1m20s\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eModify the workflow and add an additional step to configure the caches using the \u003ca href=\"https://github.com/actions/cache\"\u003ecache action\u003c/a\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSetup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eGolang\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/setup-go@v3\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003ego-version:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e~1.19\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSetup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eGolang\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecaches\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/cache@v3\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003epath:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\n        ~/.cache/go-build\n        ~/go/pkg/mod\n\u003c/span\u003e      \u003cspan class=\"hljs-attr\"\u003ekey:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erunner.os\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}-golang-${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ehashFiles('**/go.sum')\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003erestore-keys:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\n        ${{ runner.os }}-golang-\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003epath\u003c/code\u003e parameter is used to set the paths on the runner to cache or restore. The \u003ccode\u003ekey\u003c/code\u003e parameter sets the key used when saving the cache. A hash of the go.sum file is used as part of the cache key.\u003c/p\u003e\n\u003cp\u003eOptionally the restore-keys are used to find and restore a cache if there was no hit for the key. In this case we always restore the cache even if there was no specific hit for the go.sum file.\u003c/p\u003e\n\u003cp\u003eThe first time this workflow is run the cache is not populated so we see a similar execution time as without any cache of around \u003ccode\u003e1m20s\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2023-02-10-caching-in-github-actions/workflow-cache-comparison.png\" alt=\"Comparing workflow runs\"\u003e\u003c/p\u003e\n\u003cp\u003eRunning the workflow again we can see that it now completes in just \u003ccode\u003e18s\u003c/code\u003e.\u003c/p\u003e\n\u003ch3\u003eUse setup-go built-in caching\u003c/h3\u003e\n\u003cp\u003eThe V3 edition of the \u003ca href=\"https://github.com/actions/setup-go\"\u003esetup-go\u003c/a\u003e action has support for caching built-in. Under the hood it also uses the \u003ca href=\"https://github.com/actions/cache\"\u003eactions/cache\u003c/a\u003e with a similar configuration as in the example above.\u003c/p\u003e\n\u003cp\u003eThe advantage of using the built-in functionality is that it requires less configuration settings. Caching can be enabled by adding a single line to the workflow configuration:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-diff\"\u003ename: ci\n\non: push\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n        with:\n          repository: \"alexellis/registry-creds\"\n      - name: Setup Golang\n        uses: actions/setup-go@v3\n        with:\n          go-version: ~1.19\n\u003cspan class=\"hljs-addition\"\u003e+         cache: true\u003c/span\u003e\n      - name: Build\n        run: |\n          CGO_ENABLED=0 GO111MODULE=on \\\n          go build -ldflags \"-s -w -X main.Release=dev -X main.SHA=dev\" -o controller\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTriggering the workflow with the build-in cache yields similar time gains as with the manual cache configuration.\u003c/p\u003e\n\u003ch2\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eWe walked you through a short example to show you how to set up caching for a Go project and managed to build the project 4x faster.\u003c/p\u003e\n\u003cp\u003eIf you are building with Docker you can use \u003ca href=\"https://docs.docker.com/build/ci/github-actions/examples/#cache\"\u003eDocker layer caching\u003c/a\u003e to make your builds faster. Buildkit automatically caches the build results and allows exporting the cache to an external location. It has support for \u003ca href=\"https://docs.docker.com/build/cache/backends/\"\u003euploading the build cache to GitHub Actions cache\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eSee also: \u003ca href=\"https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows\"\u003eGitHub: Caching dependencies in Workflows\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eKeep in mind that there are some limitations to the GitHub Actions cache. Cache entries that have not been accessed in over 7 days will be removed. There is also a limit on the total cache size of 10 GB per repository.\u003c/p\u003e\n\u003cp\u003eSome points to take away:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUsing the actions cache is not limited to GitHub hosted runners but can be used with self-hosted runners as well.\u003c/li\u003e\n\u003cli\u003eWorkflows using the cache action can be converted to run on Actuated runners without any modifications.\u003c/li\u003e\n\u003cli\u003eJobs on Actuated runners start in a clean VM each time. This means dependencies need to be downloaded and build artifacts or caches rebuilt each time. Caching these files in the actions cache can improve workflow execution time.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWant to learn more about Go and GitHub Actions?\u003c/p\u003e\n\u003cp\u003eAlex's eBook \u003ca href=\"https://openfaas.gumroad.com/l/everyday-golang\"\u003eEveryday Golang\u003c/a\u003e has a chapter dedicated to building Go programs with Docker and GitHub Actions.\u003c/p\u003e\n\u003c/blockquote\u003e","title":"Make your builds run faster with Caching for GitHub Actions","description":"Learn how we made a Golang project build 4x faster using GitHub's built-in caching mechanism.","author":"Han Verstraete","tags":["github","actions","caching","golang"],"author_img":"welteki","image":"/images/2023-02-10-caching-in-github-actions/background.png","date":"2023-02-10"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"caching-in-github-actions"},"buildId":"H80v9ngO5xiHZEUgl-aga","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>