<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="theme-color" content="#000000"/><meta name="author" content="OpenFaaS Ltd"/><meta name="twitter:card" content="summary_large_image"/><title>Automate Packer Images with QEMU and Actuated</title><meta name="description" content="Learn how to automate Packer images using QEMU and nested virtualisation through actuated."/><meta property="twitter:title" content="Automate Packer Images with QEMU and Actuated"/><meta property="twitter:description" content="Learn how to automate Packer images using QEMU and nested virtualisation through actuated."/><meta property="og:title" content="Automate Packer Images with QEMU and Actuated"/><meta property="og:description" content="Learn how to automate Packer images using QEMU and nested virtualisation through actuated."/><meta name="twitter:image:src" content="https://actuated.dev/images/2023-07-packer/background.png"/><meta property="og:image" content="https://actuated.dev/images/2023-07-packer/background.png"/><meta name="next-head-count" content="13"/><meta charSet="utf-8"/><link rel="icon" type="image/png" href="/images/actuated.png"/><link rel="stylesheet" href="https://rsms.me/inter/inter.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css"/><link rel="manifest" href="/manifest.json"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-M5YNDNX7VT"></script><script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-M5YNDNX7VT');
          </script><link rel="apple-touch-icon" href="/images/actuated.png"/><link rel="preload" href="/_next/static/css/835182c647a0329c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/835182c647a0329c.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-34e2100d07ae5757.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ba4f0f0b110ca3d9.js" defer=""></script><script src="/_next/static/chunks/552-542f150c917a7625.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-109b0d2eddac75b5.js" defer=""></script><script src="/_next/static/bR4Jv3N8T_1-64ExyobFe/_buildManifest.js" defer=""></script><script src="/_next/static/bR4Jv3N8T_1-64ExyobFe/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-white"><header><div class="relative bg-white" data-headlessui-state=""><div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-6 sm:px-6 md:justify-start md:space-x-10 lg:px-8"><div class="flex justify-start lg:w-0 lg:flex-1"><a href="/"><span class="sr-only">Actuated</span><img class="h-8 w-auto sm:h-10" src="/images/actuated.png" alt="Actuated logo"/></a></div><div class="-my-2 -mr-2 md:hidden"><button class="inline-flex items-center justify-center rounded-md bg-white p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" type="button" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open menu</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button></div><nav class="hidden space-x-10 md:flex"><div class="relative" data-headlessui-state=""><button class="text-gray-500 group inline-flex items-center rounded-md bg-white text-base font-medium hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" type="button" aria-expanded="false" data-headlessui-state=""><span>Solutions</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd"></path></svg></button></div><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/blog">Blog</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="https://actuated.dev/blog/blazing-fast-ci-with-microvms">Announcement</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/pricing">Pricing</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="https://docs.actuated.dev/">Docs</a></nav><div class="hidden items-center justify-end md:flex md:flex-1 lg:w-0"><a href="https://dashboard.actuated.dev" class="whitespace-nowrap text-base font-medium text-gray-500 hover:text-gray-900">Sign in</a><a href="/pricing" class="ml-8 inline-flex items-center justify-center whitespace-nowrap rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700">Sign-up</a></div></div></div></header><main><div class="container mx-auto max-w-4xl bg-white mt-4 px-4 sm:px-6"><h1 id="post_title" class="text-3xl mb-3 leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl sm:leading-10 text-center">Automate Packer Images with QEMU and Actuated</h1></div><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl"><div class="border-b border-gray-200 py-4 flex items-center text-gray-500 mx-auto"><div><img class="h-10 w-10 rounded-full" src="/images/welteki.jpg" alt=""/></div><div class="ml-3"><p id="post_author" class="text-sm leading-5 font-medium text-gray-900"></p><div class="flex text-sm leading-5 text-gray-500"><time dateTime="2023-07-25" id="post_date">July 25, 2023</time><span class="mx-1"></span></div></div></div><div class="mt-6 prose sm:prose-lg max-w-none"><p id="post_description" class="mb-4">Learn how to automate Packer images using QEMU and nested virtualisation through actuated.</p></div><div id="post_content" class="mt-6 prose sm:prose-lg max-w-none"><p>One of the most popular tools for creating images for virtual machines is <a href="https://www.packer.io/">Packer</a> by <a href="https://hashicorp.com">Hashicorp</a>. Packer automates the process of building images for a variety of platforms from a single source configuration. Different builders can be used to create machines and generate images from those machines.</p>
<p>In this tutorial we will use the <a href="https://developer.hashicorp.com/packer/plugins/builders/qemu">QEMU builder</a> to create a <a href="https://www.linux-kvm.org/page/Main_Page">KVM</a> virtual machine image.</p>
<p>We will see how the Packer build can be completely automated by integrating Packer into a continuous integration (CI) pipeline with GitHub Actions. The workflow will automatically trigger image builds on changes and publish the resulting images as GitHub release artifacts.</p>
<p>Actuated supports nested virtualsation where a VM can make use of KVM to launch additional VMs within a GitHub Action. This makes it possible to run the Packer QEMU builder in GitHub Action workflows. Something that is not possible with GitHub's default hosted runners.</p>
<blockquote>
<p>See also: <a href="https://actuated.dev/blog/kvm-in-github-actions">How to run KVM guests in your GitHub Actions</a></p>
</blockquote>
<h2>Create the Packer template</h2>
<p>We will be starting from a <a href="https://cloud-images.ubuntu.com/">Ubuntu Cloud Image</a> and modify it to suit our needs. If you need total control of what goes into the image you can start from scratch using the ISO.</p>
<p>Variables are used in the packer template to set the <code>iso_url</code> and <code>iso_checksum</code>. In addition to these we also use variables to configure the <code>disk_size</code>, <code>ram</code>, <code>cpu</code>, <code>ssh_password</code> and <code>ssh_username</code>:</p>
<pre><code>variable "cpu" {
  type    = string
  default = "2"
}

variable "disk_size" {
  type    = string
  default = "40000"
}

variable "headless" {
  type    = string
  default = "true"
}

variable "iso_checksum" {
  type    = string
  default = "sha256:d699ae158ec028db69fd850824ee6e14c073b02ad696b4efb8c59d37c8025aaa"
}

variable "iso_url" {
  type    = string
  default = "https://cloud-images.ubuntu.com/jammy/20230719/jammy-server-cloudimg-amd64.img"
}

variable "name" {
  type    = string
  default = "jammy"
}

variable "ram" {
  type    = string
  default = "2048"
}

variable "ssh_password" {
  type    = string
  default = "ubuntu"
}

variable "ssh_username" {
  type    = string
  default = "ubuntu"
}

variable "version" {
  type    = string
  default = ""
}

variable "format" {
  type    = string
  default = "qcow2"
}
</code></pre>
<p>The Packer source configuration:</p>
<pre><code>source "qemu" "jammy" {
  accelerator      = "kvm"
  boot_command     = []
  disk_compression = true
  disk_interface   = "virtio"
  disk_image       = true
  disk_size        = var.disk_size
  format           = var.format
  headless         = var.headless
  iso_checksum     = var.iso_checksum
  iso_url          = var.iso_url
  net_device       = "virtio-net"
  output_directory = "artifacts/qemu/${var.name}${var.version}"
  qemuargs = [
    ["-m", "${var.ram}M"],
    ["-smp", "${var.cpu}"],
    ["-cdrom", "cidata.iso"]
  ]
  communicator           = "ssh"
  shutdown_command       = "echo '${var.ssh_password}' | sudo -S shutdown -P now"
  ssh_password           = var.ssh_password
  ssh_username           = var.ssh_username
  ssh_timeout            = "10m"
}
</code></pre>
<p>Some notable settings in the source configuration:</p>
<ul>
<li>We set <code>disk_image=true</code> since we are starting from an Ubuntu Cloud Image. If you wanted to launch an ISO based installation this would have to be false.</li>
<li>Notice how the variables are used to configure different VM settings like disk size: <code>disk_size=var.disk_size</code>, image output format: <code>format=var.format</code> and the RAM and CPU for the vm through <code>qemuargs</code>.</li>
<li>The <code>ssh_username</code> and <code>ssh_password</code> that Packer can use to establish an ssh connection to the VM are also configured.</li>
</ul>
<p>In the next section we will see how <a href="https://cloudinit.readthedocs.io/en/latest/">cloud-init</a> is used to setup user account with the correct password that Packer needs for provisioning.</p>
<p>The full example of the packer file is available on <a href="https://github.com/skatolo/actuated-packer-qemu">GitHub</a>.</p>
<h3>Create the user-data file</h3>
<p>Cloud images provided by Canonical do not have users by default. The Ubuntu images use <a href="https://cloudinit.readthedocs.io/en/latest/">cloud-init</a> to pre-configure the system during boot.</p>
<p>Packer uses provisioners to install and configure the machine image after booting. To run these provisioners Packer needs to be able to communicate with the machine. By default this happens by establishing an ssh connection to the machine.</p>
<p>Create a user-data file that sets the password of the default user so that it can be used by Packer to connect over ssh:</p>
<pre><code>#cloud-config
password: ubuntu
ssh_pwauth: true
chpasswd:
  expire: false
</code></pre>
<p>Next create an ISO that can be referenced by our Packer template and presented to the VM:</p>
<pre><code class="hljs language-bash">genisoimage -output cidata.iso -input-charset utf-8 -volid cidata -joliet -r \
</code></pre>
<p>The ISO can be mounted by QEMU to provide the configuration data to <code>cloud-init</code> while the VM boots.</p>
<p>The <code>-cdrom</code> flag is used in the <code>qemuargs</code> field to mount the <code>cidata.iso</code> file:</p>
<pre><code>  qemuargs = [
    ["-m", "${var.ram}M"],
    ["-smp", "${var.cpu}"],
    ["-cdrom", "cidata.iso"]
  ]
</code></pre>
<h3>Provision the image</h3>
<p>The build section of the Packer template is used to define provisioners that can run scripts and commands to install software and configure the machine.</p>
<p>In this example we are installing python3 but you can run any script you want or use tools like <a href="https://www.ansible.com/">Ansible</a> to automate the configuration.</p>
<pre><code>build {
  sources = ["source.qemu.jammy"]

  provisioner "shell" {
    execute_command = "{{ .Vars }} sudo -E bash '{{ .Path }}'"
    inline          = ["sudo apt update", "sudo apt install python3"]
  }

  post-processor "shell-local" {
    environment_vars = ["IMAGE_NAME=${var.name}", "IMAGE_VERSION=${var.version}", "IMAGE_FORMAT=${var.format}"]
    script           = "scripts/prepare-image.sh"
  }
}
</code></pre>
<h3>Prepare the image for publishing.</h3>
<p>Packer supports post-processors. They only run after Packer saves an instance as an image. Post-processors are commonly used to compress artifacts, upload them into a cloud, etc. See the <a href="https://developer.hashicorp.com/packer/tutorials/docker-get-started/docker-get-started-post-processors">Packer docs</a> for more use-cases and examples.</p>
<p>We will add a post processing step to the packer template to run the <code>prepare-image.sh</code> script. This script renames the image artifacts and calculates the shasum to prepare them to be uploaded as release artifacts on GitHub.</p>
<pre><code>  post-processor "shell-local" {
    environment_vars = ["IMAGE_NAME=${var.name}", "IMAGE_VERSION=${var.version}", "IMAGE_FORMAT=${var.format}"]
    script           = "scripts/prepare-image.sh"
  }
</code></pre>
<h3>Launch the build locally</h3>
<p>If your local system is setup correctly, it has the packer binary and qemu installed, you can build with just:</p>
<pre><code class="hljs language-bash">packer build .
</code></pre>
<p>The artifacts folder will contain the resulting machine image and shasum file after the build completes.</p>
<pre><code>artifacts
└── qemu
    └── jammy
        ├── jammy.qcow2
        └── jammy.qcow2.sha256sum
</code></pre>
<h2>Automate image releases with GitHub Actions.</h2>
<p>For the QEMU builder to run at peak performance it requires hardware acceleration. This is not always possible in CI runners. GitHub's hosted runners do not support nested virtualization. With Actuated we added support for launching Virtual Machines in GitHub Action pipelines. This makes it possible to run the Packer QEMU builder in your workflows.</p>
<p>Support for KVM is not enabled by default on Actuated and there are some prerequisites:</p>
<ul>
<li><code>arm64</code> runners are not supported at the moment</li>
<li>A bare-metal host that supports nested virtualization is required for the Agent.</li>
</ul>
<p>To configure your Actuated Agent for KVM support follow the <a href="https://docs.actuated.dev/examples/kvm-guest/">instructions in the docs</a>.</p>
<h3>The GitHub actions workflow</h3>
<p>The default GitHub hosted runners come with Packer pre-installed. On self-hosted runners you will need a step to install the Packer binary. The official [setup-packer][<a href="https://github.com/hashicorp/setup-packer">https://github.com/hashicorp/setup-packer</a>] action can be used for this.</p>
<p>We set <code>runs-on</code> to <code>actuated</code> so that the build workflow will run on an Actuated runner:</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Build</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">tags:</span> [<span class="hljs-string">"v[0-9].[0-9]+.[0-9]+"</span>]
    <span class="hljs-attr">branches:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"main"</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build-image:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">actuated</span>
    <span class="hljs-comment">##...</span>
</code></pre>
<p>The build job runs the following steps:</p>
<ol>
<li>
<p>Retrieve the Packer configuration by checking out the GitHub repository.</p>
<pre><code class="hljs language-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">Repository</span>
  <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
</code></pre>
</li>
<li>
<p>Install QEMU to ensure Packer is able to launch kvm/qemu virtual machines.</p>
<pre><code class="hljs language-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">qemu</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">sudo</span> <span class="hljs-string">apt-get</span> <span class="hljs-string">update</span> <span class="hljs-string">&#x26;&#x26;</span> <span class="hljs-string">sudo</span> <span class="hljs-string">apt-get</span> <span class="hljs-string">install</span> <span class="hljs-string">qemu-system</span> <span class="hljs-string">-y</span>
</code></pre>
</li>
<li>
<p>Setup packet to ensure the binary is available in the path.</p>
<pre><code class="hljs language-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">packer</span>
  <span class="hljs-attr">uses:</span> <span class="hljs-string">hashicorp/setup-packer@main</span>
</code></pre>
</li>
<li>
<p>Initialize the packer template and install all plugins referenced by the template.</p>
<pre><code class="hljs language-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Packer</span> <span class="hljs-string">Init</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">packer</span> <span class="hljs-string">init</span> <span class="hljs-string">.</span>
</code></pre>
</li>
<li>
<p>Build the images defined in the root directory. Before we run the <code>packer build</code> command we make <code>/dev/kvm</code> world read-writable so that the QEMU builder can use it.</p>
<pre><code class="hljs language-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Packer</span> <span class="hljs-string">Build</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">|
    sudo chmod o+rw /dev/kvm
    packer build .
</span></code></pre>
</li>
<li>
<p>Upload the images as GitHub release artifacts. This job only runs for tagged commits.</p>
<pre><code class="hljs language-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">images</span> <span class="hljs-string">and</span> <span class="hljs-string">their</span> <span class="hljs-string">SHA</span> <span class="hljs-string">to</span> <span class="hljs-string">Github</span> <span class="hljs-string">Release</span>
  <span class="hljs-attr">if:</span> <span class="hljs-string">startsWith(github.ref,</span> <span class="hljs-string">'refs/tags/v'</span><span class="hljs-string">)</span>
  <span class="hljs-attr">uses:</span> <span class="hljs-string">alexellis/upload-assets@0.4.0</span>
  <span class="hljs-attr">env:</span>
    <span class="hljs-attr">GITHUB_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.GITHUB_TOKEN</span> <span class="hljs-string">}}</span>
  <span class="hljs-attr">with:</span>
    <span class="hljs-attr">asset_paths:</span> <span class="hljs-string">'["./artifacts/qemu/*/*"]'</span>
</code></pre>
</li>
</ol>
<h2>Taking it further</h2>
<p>We created a GitHub actions workflow that can run a Packer build with QEMU to create a custom Ubuntu image. The resulting <code>qcow2</code> image is automatically uploaded to the GitHub release assets on each release.</p>
<p>The released image can be downloaded and used to spin up a VM instance on your private hardware or on different cloud providers.</p>
<p>We exported the image in <code>qcow2</code> format but you might need a different image format. The QEMU builder also supports outputting images in <code>raw</code> format. In our Packer template the output format can be changed by setting the <code>format</code> variable.</p>
<p>Additional tools like the <a href="https://www.qemu.org/docs/master/tools/qemu-img.html">qemu disk image utility</a> can also be used to convert images between different formats. A <a href="https://developer.hashicorp.com/packer/docs/templates/hcl_templates/blocks/build/post-processor">post-processor</a> would be the ideal place for these kinds of extra processing steps.</p>
<p>AWS also supports importing VM images and converting them to an AMI so they can be used to launch EC2 instances. See: <a href="https://docs.aws.amazon.com/vm-import/latest/userguide/vmimport-image-import.html">Create an AMI from a VM image</a></p>
<p>If you'd like to know more about nested virtualisation support, check out: <a href="https://actuated.dev/blog/kvm-in-github-actions">How to run KVM guests in your GitHub Actions</a></p></div></div></main><footer class="bg-white"><div class="mx-auto max-w-7xl py-12 px-4 sm:px-6 md:flex md:items-center md:justify-between lg:px-8"><div class="flex justify-center space-x-6 md:order-2"><a class="text-gray-400 hover:text-gray-500" href="https://twitter.com/selfactuated"><span class="sr-only">Twitter</span><svg fill="currentColor" viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg></a><a class="text-gray-400 hover:text-gray-500" href="https://github.com/self-actuated"><span class="sr-only">GitHub</span><svg fill="currentColor" viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg></a><a class="text-gray-400 hover:text-gray-500" href="/rss.xml"><span class="sr-only">RSS</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"></path></svg></a></div><div class="mt-8 md:order-1 md:mt-0"><p class="text-center text-base text-gray-400">© 2022 <a href="https://openfaas.com">OpenFaaS Ltd</a>, Inc. All rights reserved.</p></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"automate-packer-qemu-image-builds","fileName":"2023-07-25-automate-packer-qemu-image-builds.md","contentHtml":"\u003cp\u003eOne of the most popular tools for creating images for virtual machines is \u003ca href=\"https://www.packer.io/\"\u003ePacker\u003c/a\u003e by \u003ca href=\"https://hashicorp.com\"\u003eHashicorp\u003c/a\u003e. Packer automates the process of building images for a variety of platforms from a single source configuration. Different builders can be used to create machines and generate images from those machines.\u003c/p\u003e\n\u003cp\u003eIn this tutorial we will use the \u003ca href=\"https://developer.hashicorp.com/packer/plugins/builders/qemu\"\u003eQEMU builder\u003c/a\u003e to create a \u003ca href=\"https://www.linux-kvm.org/page/Main_Page\"\u003eKVM\u003c/a\u003e virtual machine image.\u003c/p\u003e\n\u003cp\u003eWe will see how the Packer build can be completely automated by integrating Packer into a continuous integration (CI) pipeline with GitHub Actions. The workflow will automatically trigger image builds on changes and publish the resulting images as GitHub release artifacts.\u003c/p\u003e\n\u003cp\u003eActuated supports nested virtualsation where a VM can make use of KVM to launch additional VMs within a GitHub Action. This makes it possible to run the Packer QEMU builder in GitHub Action workflows. Something that is not possible with GitHub's default hosted runners.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eSee also: \u003ca href=\"https://actuated.dev/blog/kvm-in-github-actions\"\u003eHow to run KVM guests in your GitHub Actions\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003eCreate the Packer template\u003c/h2\u003e\n\u003cp\u003eWe will be starting from a \u003ca href=\"https://cloud-images.ubuntu.com/\"\u003eUbuntu Cloud Image\u003c/a\u003e and modify it to suit our needs. If you need total control of what goes into the image you can start from scratch using the ISO.\u003c/p\u003e\n\u003cp\u003eVariables are used in the packer template to set the \u003ccode\u003eiso_url\u003c/code\u003e and \u003ccode\u003eiso_checksum\u003c/code\u003e. In addition to these we also use variables to configure the \u003ccode\u003edisk_size\u003c/code\u003e, \u003ccode\u003eram\u003c/code\u003e, \u003ccode\u003ecpu\u003c/code\u003e, \u003ccode\u003essh_password\u003c/code\u003e and \u003ccode\u003essh_username\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003evariable \"cpu\" {\n  type    = string\n  default = \"2\"\n}\n\nvariable \"disk_size\" {\n  type    = string\n  default = \"40000\"\n}\n\nvariable \"headless\" {\n  type    = string\n  default = \"true\"\n}\n\nvariable \"iso_checksum\" {\n  type    = string\n  default = \"sha256:d699ae158ec028db69fd850824ee6e14c073b02ad696b4efb8c59d37c8025aaa\"\n}\n\nvariable \"iso_url\" {\n  type    = string\n  default = \"https://cloud-images.ubuntu.com/jammy/20230719/jammy-server-cloudimg-amd64.img\"\n}\n\nvariable \"name\" {\n  type    = string\n  default = \"jammy\"\n}\n\nvariable \"ram\" {\n  type    = string\n  default = \"2048\"\n}\n\nvariable \"ssh_password\" {\n  type    = string\n  default = \"ubuntu\"\n}\n\nvariable \"ssh_username\" {\n  type    = string\n  default = \"ubuntu\"\n}\n\nvariable \"version\" {\n  type    = string\n  default = \"\"\n}\n\nvariable \"format\" {\n  type    = string\n  default = \"qcow2\"\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe Packer source configuration:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esource \"qemu\" \"jammy\" {\n  accelerator      = \"kvm\"\n  boot_command     = []\n  disk_compression = true\n  disk_interface   = \"virtio\"\n  disk_image       = true\n  disk_size        = var.disk_size\n  format           = var.format\n  headless         = var.headless\n  iso_checksum     = var.iso_checksum\n  iso_url          = var.iso_url\n  net_device       = \"virtio-net\"\n  output_directory = \"artifacts/qemu/${var.name}${var.version}\"\n  qemuargs = [\n    [\"-m\", \"${var.ram}M\"],\n    [\"-smp\", \"${var.cpu}\"],\n    [\"-cdrom\", \"cidata.iso\"]\n  ]\n  communicator           = \"ssh\"\n  shutdown_command       = \"echo '${var.ssh_password}' | sudo -S shutdown -P now\"\n  ssh_password           = var.ssh_password\n  ssh_username           = var.ssh_username\n  ssh_timeout            = \"10m\"\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSome notable settings in the source configuration:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWe set \u003ccode\u003edisk_image=true\u003c/code\u003e since we are starting from an Ubuntu Cloud Image. If you wanted to launch an ISO based installation this would have to be false.\u003c/li\u003e\n\u003cli\u003eNotice how the variables are used to configure different VM settings like disk size: \u003ccode\u003edisk_size=var.disk_size\u003c/code\u003e, image output format: \u003ccode\u003eformat=var.format\u003c/code\u003e and the RAM and CPU for the vm through \u003ccode\u003eqemuargs\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003essh_username\u003c/code\u003e and \u003ccode\u003essh_password\u003c/code\u003e that Packer can use to establish an ssh connection to the VM are also configured.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn the next section we will see how \u003ca href=\"https://cloudinit.readthedocs.io/en/latest/\"\u003ecloud-init\u003c/a\u003e is used to setup user account with the correct password that Packer needs for provisioning.\u003c/p\u003e\n\u003cp\u003eThe full example of the packer file is available on \u003ca href=\"https://github.com/skatolo/actuated-packer-qemu\"\u003eGitHub\u003c/a\u003e.\u003c/p\u003e\n\u003ch3\u003eCreate the user-data file\u003c/h3\u003e\n\u003cp\u003eCloud images provided by Canonical do not have users by default. The Ubuntu images use \u003ca href=\"https://cloudinit.readthedocs.io/en/latest/\"\u003ecloud-init\u003c/a\u003e to pre-configure the system during boot.\u003c/p\u003e\n\u003cp\u003ePacker uses provisioners to install and configure the machine image after booting. To run these provisioners Packer needs to be able to communicate with the machine. By default this happens by establishing an ssh connection to the machine.\u003c/p\u003e\n\u003cp\u003eCreate a user-data file that sets the password of the default user so that it can be used by Packer to connect over ssh:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e#cloud-config\npassword: ubuntu\nssh_pwauth: true\nchpasswd:\n  expire: false\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNext create an ISO that can be referenced by our Packer template and presented to the VM:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egenisoimage -output cidata.iso -input-charset utf-8 -volid cidata -joliet -r \\\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe ISO can be mounted by QEMU to provide the configuration data to \u003ccode\u003ecloud-init\u003c/code\u003e while the VM boots.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003e-cdrom\u003c/code\u003e flag is used in the \u003ccode\u003eqemuargs\u003c/code\u003e field to mount the \u003ccode\u003ecidata.iso\u003c/code\u003e file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e  qemuargs = [\n    [\"-m\", \"${var.ram}M\"],\n    [\"-smp\", \"${var.cpu}\"],\n    [\"-cdrom\", \"cidata.iso\"]\n  ]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eProvision the image\u003c/h3\u003e\n\u003cp\u003eThe build section of the Packer template is used to define provisioners that can run scripts and commands to install software and configure the machine.\u003c/p\u003e\n\u003cp\u003eIn this example we are installing python3 but you can run any script you want or use tools like \u003ca href=\"https://www.ansible.com/\"\u003eAnsible\u003c/a\u003e to automate the configuration.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ebuild {\n  sources = [\"source.qemu.jammy\"]\n\n  provisioner \"shell\" {\n    execute_command = \"{{ .Vars }} sudo -E bash '{{ .Path }}'\"\n    inline          = [\"sudo apt update\", \"sudo apt install python3\"]\n  }\n\n  post-processor \"shell-local\" {\n    environment_vars = [\"IMAGE_NAME=${var.name}\", \"IMAGE_VERSION=${var.version}\", \"IMAGE_FORMAT=${var.format}\"]\n    script           = \"scripts/prepare-image.sh\"\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003ePrepare the image for publishing.\u003c/h3\u003e\n\u003cp\u003ePacker supports post-processors. They only run after Packer saves an instance as an image. Post-processors are commonly used to compress artifacts, upload them into a cloud, etc. See the \u003ca href=\"https://developer.hashicorp.com/packer/tutorials/docker-get-started/docker-get-started-post-processors\"\u003ePacker docs\u003c/a\u003e for more use-cases and examples.\u003c/p\u003e\n\u003cp\u003eWe will add a post processing step to the packer template to run the \u003ccode\u003eprepare-image.sh\u003c/code\u003e script. This script renames the image artifacts and calculates the shasum to prepare them to be uploaded as release artifacts on GitHub.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e  post-processor \"shell-local\" {\n    environment_vars = [\"IMAGE_NAME=${var.name}\", \"IMAGE_VERSION=${var.version}\", \"IMAGE_FORMAT=${var.format}\"]\n    script           = \"scripts/prepare-image.sh\"\n  }\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eLaunch the build locally\u003c/h3\u003e\n\u003cp\u003eIf your local system is setup correctly, it has the packer binary and qemu installed, you can build with just:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epacker build .\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe artifacts folder will contain the resulting machine image and shasum file after the build completes.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eartifacts\n└── qemu\n    └── jammy\n        ├── jammy.qcow2\n        └── jammy.qcow2.sha256sum\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eAutomate image releases with GitHub Actions.\u003c/h2\u003e\n\u003cp\u003eFor the QEMU builder to run at peak performance it requires hardware acceleration. This is not always possible in CI runners. GitHub's hosted runners do not support nested virtualization. With Actuated we added support for launching Virtual Machines in GitHub Action pipelines. This makes it possible to run the Packer QEMU builder in your workflows.\u003c/p\u003e\n\u003cp\u003eSupport for KVM is not enabled by default on Actuated and there are some prerequisites:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003earm64\u003c/code\u003e runners are not supported at the moment\u003c/li\u003e\n\u003cli\u003eA bare-metal host that supports nested virtualization is required for the Agent.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTo configure your Actuated Agent for KVM support follow the \u003ca href=\"https://docs.actuated.dev/examples/kvm-guest/\"\u003einstructions in the docs\u003c/a\u003e.\u003c/p\u003e\n\u003ch3\u003eThe GitHub actions workflow\u003c/h3\u003e\n\u003cp\u003eThe default GitHub hosted runners come with Packer pre-installed. On self-hosted runners you will need a step to install the Packer binary. The official [setup-packer][\u003ca href=\"https://github.com/hashicorp/setup-packer\"\u003ehttps://github.com/hashicorp/setup-packer\u003c/a\u003e] action can be used for this.\u003c/p\u003e\n\u003cp\u003eWe set \u003ccode\u003eruns-on\u003c/code\u003e to \u003ccode\u003eactuated\u003c/code\u003e so that the build workflow will run on an Actuated runner:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBuild\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003eon:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003epush:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003etags:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003e\"v[0-9].[0-9]+.[0-9]+\"\u003c/span\u003e]\n    \u003cspan class=\"hljs-attr\"\u003ebranches:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"main\"\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003ejobs:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebuild-image:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBuild\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactuated\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e##...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe build job runs the following steps:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eRetrieve the Packer configuration by checking out the GitHub repository.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCheckout\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRepository\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/checkout@v3\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eInstall QEMU to ensure Packer is able to launch kvm/qemu virtual machines.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eInstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eqemu\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eapt-get\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eupdate\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eapt-get\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003einstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eqemu-system\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e-y\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSetup packet to ensure the binary is available in the path.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSetup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epacker\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ehashicorp/setup-packer@main\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eInitialize the packer template and install all plugins referenced by the template.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePacker\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eInit\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epacker\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003einit\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBuild the images defined in the root directory. Before we run the \u003ccode\u003epacker build\u003c/code\u003e command we make \u003ccode\u003e/dev/kvm\u003c/code\u003e world read-writable so that the QEMU builder can use it.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePacker\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBuild\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\n    sudo chmod o+rw /dev/kvm\n    packer build .\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eUpload the images as GitHub release artifacts. This job only runs for tagged commits.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eUpload\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eimages\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eand\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etheir\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSHA\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eto\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eGithub\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRelease\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eif:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003estartsWith(github.ref,\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'refs/tags/v'\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ealexellis/upload-assets@0.4.0\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eGITHUB_TOKEN:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.GITHUB_TOKEN\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003easset_paths:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'[\"./artifacts/qemu/*/*\"]'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eTaking it further\u003c/h2\u003e\n\u003cp\u003eWe created a GitHub actions workflow that can run a Packer build with QEMU to create a custom Ubuntu image. The resulting \u003ccode\u003eqcow2\u003c/code\u003e image is automatically uploaded to the GitHub release assets on each release.\u003c/p\u003e\n\u003cp\u003eThe released image can be downloaded and used to spin up a VM instance on your private hardware or on different cloud providers.\u003c/p\u003e\n\u003cp\u003eWe exported the image in \u003ccode\u003eqcow2\u003c/code\u003e format but you might need a different image format. The QEMU builder also supports outputting images in \u003ccode\u003eraw\u003c/code\u003e format. In our Packer template the output format can be changed by setting the \u003ccode\u003eformat\u003c/code\u003e variable.\u003c/p\u003e\n\u003cp\u003eAdditional tools like the \u003ca href=\"https://www.qemu.org/docs/master/tools/qemu-img.html\"\u003eqemu disk image utility\u003c/a\u003e can also be used to convert images between different formats. A \u003ca href=\"https://developer.hashicorp.com/packer/docs/templates/hcl_templates/blocks/build/post-processor\"\u003epost-processor\u003c/a\u003e would be the ideal place for these kinds of extra processing steps.\u003c/p\u003e\n\u003cp\u003eAWS also supports importing VM images and converting them to an AMI so they can be used to launch EC2 instances. See: \u003ca href=\"https://docs.aws.amazon.com/vm-import/latest/userguide/vmimport-image-import.html\"\u003eCreate an AMI from a VM image\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIf you'd like to know more about nested virtualisation support, check out: \u003ca href=\"https://actuated.dev/blog/kvm-in-github-actions\"\u003eHow to run KVM guests in your GitHub Actions\u003c/a\u003e\u003c/p\u003e","title":"Automate Packer Images with QEMU and Actuated","description":"Learn how to automate Packer images using QEMU and nested virtualisation through actuated.","tags":["images","packer","qemu","kvm"],"author_img":"welteki","image":"/images/2023-07-packer/background.png","date":"2023-07-25"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"automate-packer-qemu-image-builds"},"buildId":"bR4Jv3N8T_1-64ExyobFe","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>