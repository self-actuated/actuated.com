<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width, initial-scale=1" data-next-head=""/><meta name="theme-color" content="#000000" data-next-head=""/><meta name="author" content="OpenFaaS Ltd" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><title data-next-head="">On Running Millions of Arm CI Minutes for the CNCF</title><meta name="description" content="We&#x27;ve now run over 1.5 million minutes of CI time for various CNCF projects on Ampere hardware. Here&#x27;s what we&#x27;ve learned." data-next-head=""/><meta property="twitter:title" content="On Running Millions of Arm CI Minutes for the CNCF" data-next-head=""/><meta property="twitter:description" content="We&#x27;ve now run over 1.5 million minutes of CI time for various CNCF projects on Ampere hardware. Here&#x27;s what we&#x27;ve learned." data-next-head=""/><meta property="og:title" content="On Running Millions of Arm CI Minutes for the CNCF" data-next-head=""/><meta property="og:description" content="We&#x27;ve now run over 1.5 million minutes of CI time for various CNCF projects on Ampere hardware. Here&#x27;s what we&#x27;ve learned." data-next-head=""/><meta name="twitter:image:src" content="https://actuated.com/images/2024-05-cncf-millions/background.png" data-next-head=""/><meta property="og:image" content="https://actuated.com/images/2024-05-cncf-millions/background.png" data-next-head=""/><meta charSet="utf-8"/><link rel="icon" type="image/png" href="/images/actuated.png"/><link rel="stylesheet" href="https://rsms.me/inter/inter.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css"/><link rel="manifest" href="/manifest.json"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-M5YNDNX7VT"></script><script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-M5YNDNX7VT');
          </script><link rel="apple-touch-icon" href="/images/actuated.png"/><link rel="preload" href="/_next/static/css/e249dc86480b2164.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e249dc86480b2164.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-fbb920bddf9bf0a6.js" defer=""></script><script src="/_next/static/chunks/framework-5757d75364ce2279.js" defer=""></script><script src="/_next/static/chunks/main-ef55e8b75fd0cd35.js" defer=""></script><script src="/_next/static/chunks/pages/_app-381d430d4a735a5d.js" defer=""></script><script src="/_next/static/chunks/762-703a014cadea8bf4.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-053ab830ac6cb307.js" defer=""></script><script src="/_next/static/sjnTidXm8PRh7DDL0ohJw/_buildManifest.js" defer=""></script><script src="/_next/static/sjnTidXm8PRh7DDL0ohJw/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-white"><header><div class="relative bg-white" data-headlessui-state=""><div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-6 sm:px-6 md:justify-start md:space-x-10 lg:px-8"><div class="flex justify-start lg:w-0 lg:flex-1"><a href="/"><span class="sr-only">Actuated</span><img class="h-8 w-auto sm:h-10" src="/images/actuated.png" alt="Actuated logo"/></a></div><div class="-my-2 -mr-2 md:hidden"><button class="inline-flex items-center justify-center rounded-md bg-white p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" type="button" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open menu</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button></div><nav class="hidden space-x-10 md:flex"><div class="relative" data-headlessui-state=""><button class="text-gray-500 group inline-flex items-center rounded-md bg-white text-base font-medium hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" type="button" aria-expanded="false" data-headlessui-state=""><span>Solutions</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd"></path></svg></button></div><span hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></span><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/blog">Blog</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/blog/blazing-fast-ci-with-microvms">Announcement</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/pricing">Pricing</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="https://docs.actuated.com/">Docs</a></nav><span hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></span><div class="hidden items-center justify-end md:flex md:flex-1 lg:w-0"><a href="https://dashboard.actuated.com" class="whitespace-nowrap text-base font-medium text-gray-500 hover:text-gray-900">Sign in</a><a href="/pricing" class="ml-8 inline-flex items-center justify-center whitespace-nowrap rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700">Sign-up</a></div></div></div><span hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></span></header><main><div class="container mx-auto max-w-4xl bg-white mt-4 px-4 sm:px-6"><h1 id="post_title" class="text-3xl mb-3 leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl sm:leading-10 text-center">On Running Millions of Arm CI Minutes for the CNCF</h1></div><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl"><div class="border-b border-gray-200 py-4 flex items-center text-gray-500 mx-auto"><div><img class="h-10 w-10 rounded-full" src="/images/alex.jpg" alt=""/></div><div class="ml-3"><p id="post_author" class="text-sm leading-5 font-medium text-gray-900"></p><div class="flex text-sm leading-5 text-gray-500"><time dateTime="2024-05-30" id="post_date">May 30, 2024</time><span class="mx-1"></span></div></div></div><div class="mt-6 prose sm:prose-lg max-w-none"><p id="post_description" class="mb-4">We&#x27;ve now run over 1.5 million minutes of CI time for various CNCF projects on Ampere hardware. Here&#x27;s what we&#x27;ve learned.</p></div><div id="post_content" class="mt-6 prose sm:prose-lg max-w-none"><p>In this post I'll cover:</p>
<ul>
<li>Who's the program to bring actuated to the CNCF</li>
<li>A new video interview with our team, the CNCF, Ampere and Equinix Metal</li>
<li>What options teams had for Arm both and then after the program</li>
<li>The high level numbers, and how that's split over the top 9 projects</li>
<li>What's next for the program</li>
</ul>
<h3 id="whats-actuated">What's Actuated?</h3>
<blockquote>
<p>Actuated is the only solution that gives a managed experience for self-hosted runners, on your own hardware through immutable microVMs.</p>
</blockquote>
<p>The immutability is key to both security and reliability. Each build is run in its own ephemeral and immutable microVM, meaning side effects cannot be left behind by prior builds. In addition, our team manages reliability for your servers and the integration with GitHub, for minimal disruption during GitHub outages.</p>
<h2 id="why-did-the-cncf-want-actuated-for-its-projects">Why did the CNCF want Actuated for its projects?</h2>
<p>We've been working with <a href="https://amperecomputing.com/">Ampere</a> and <a href="https://deploy.equinix.com/">Equinix Metal</a> to provide CI via GitHub Actions for Cloud Native Computing (CNCF) projects. Ampere manufacture Arm-based CPUs with a focus on efficiency and high core density. Equinix Metal provide access to the Ampere Altra in their datacenters around the world.</p>
<p>Last December, we met with <a href="https://www.linkedin.com/in/caniszczyk/">Chris Aniszczyck</a> - CTO Linux Foundation/CNCF, <a href="https://www.linkedin.com/in/edwardvielmetti/">Ed Vielmetti</a> - Open Source Manager Equinix, <a href="https://www.linkedin.com/in/dneary/">Dave Neary</a> - Director of Developer Relations at Ampere and myself to discuss the program and what impact it was having so far.</p>
<p>Watch the recap on YouTube: <a href="https://www.youtube.com/watch?v=sv3jtSvW9gk">The Ampere Developer Impact: CNCF Pilot Discussion</a></p>
<p>Past articles on the blog include:</p>
<ul>
<li>October 2023 launch - <a href="/blog/arm-ci-cncf-ampere">Announcing managed Arm CI for CNCF projects</a></li>
<li>March 2024 update - <a href="/blog/cncf-arm-march-update">The state of Arm CI for the CNCF</a></li>
</ul>
<h2 id="before-and-after-the-program">Before and after the program</h2>
<p>Before we started the program, CNCF projects could be divided into three buckets:</p>
<ol>
<li>They were running Arm-based CI jobs on static servers that they managed</li>
</ol>
<p>In this case, etcd for instance had a team of half a dozen maintainers who were responsible for setting up, maintaining, and upgrading statically provisioned CI servers for the project. This was a significant overhead for the project maintainers, and the servers were often underutilized. The risk of side-effects being left behind between builds also posed a serious supply chain risk since etcd is consumed in virtually every Kubernetes deployment.</p>
<ol start="2">
<li>They were running Arm-based CI using emulation (QEMU)</li>
</ol>
<p>QEMU can be combined with Docker's buildx for a quick and convenient way to build container images for x86 and Arm architectures. In the best case, it's a small change and may add a few minutes of extra overhead. In the worst case, we saw that jobs that ran in ~ 5 minutes, took over 6 hours to complete using QEMU and hosted runners. A prime example was fluentd, read their case-study here: <a href="https://calyptia.com/blog/scaling-builds-with-actuated">Scaling ARM builds with Actuated</a></p>
<ol start="3">
<li>They had no Arm CI at all</li>
</ol>
<p>In the third case, we saw projects like OpenTelemetry which had no support for Arm at all, but demand from their community to bring it up to on par with x86 builds. The need to self-manage insecure CI servers meant that Arm was a blocker for them.</p>
<h3 id="after-the-program">After the program</h3>
<p>After the program was live, teams who had been maintaining their own servers got to remove lengthy documentation on server configuration and maintenance, and relied on our team to manage a pool of servers used for scheduling microVMs.</p>
<p>As demand grew, we saw OpenTelemetry and etcd starve the shared pool of resources through very high usage patterns. This is a classic and known problem called "Tragedy of the Commons" - when a shared resource is overused by a subset of users, it can lead to a degradation of service for all users. To combat the problem, we added code to provision self-destructing servers for a period of 24-48 hours as need arose, and prevented the higher usage projects from running on at least on of the permanent servers through scheduling rules. One other issue we saw with OpenTelemetry in particular was that the various Go proxies that offer up Go modules appeared to be rejecting requests when too many jobs were running concurrently. As a workaround, we added a private Go proxy for them into the private network space where the CNCF servers run, this also massively reduced the bandwidth costs for the shared infrastructure.</p>
<p><a href="https://calyptia.com/blog/scaling-builds-with-actuated">Teams like fluent</a> moved from flakey builds that couldn't finish in 6 hours, to builds that finished in 5-10 minutes. This meant they could expand on their suite of tests.</p>
<p>Where teams such as Cilium, Falco, or OpenTelemetry had no Arm CI support, we saw them quickly ramp up to running thousands of builds per month.</p>
<p>Here's a quote from <a href="https://www.linkedin.com/in/fededp/">Federico Di Pierro</a>, Senior Open Source Engineer @ Sysdig and maintainer of Falco:</p>
<blockquote>
<p>Falco really needed arm64 GitHub runners to elevate its support for the architecture and enlarge its userbase.
Actuated was the perfect solution for us because it was easy to leverage and relieved any burden for the maintainers. This way, we as maintainers, can focus on what really matters for the project, instead of fighting with maintaining and deploying self-hosted infrastructure.
Now we are building, testing and releasing artifacts for arm64 leveraging Actuated for many of our projects, and it works flawlessly.
Support from Alex's team is always on point, and new kernel features are coming through super quickly!</p>
</blockquote>
<p><a href="https://github.com/akihirosuda">Akihiro Suda</a>, Software Engineer at NTT Corp, and maintainer of several open source projects including: runc, containerd and lima had this to say:</p>
<blockquote>
<p>Huge thanks to Actuated for enabling us to run ARM64 tests without any mess.
It is very important for the runc project to run the tests on ARM64, as runc depends on several architecture-dependent components such as seccomp and criu.
It is also so nice that the Arm instance specification can be adjusted in a single line in the GitHub Actions workflow file.</p>
</blockquote>
<p><a href="https://github.com/fuweid">Wei Fu</a>, a maintainer for containerd said:</p>
<blockquote>
<p>The containerd project was able to test each pull request for the Linux arm64 platform with the support of Actuated.
It's a significant step for containerd to mark the Linux arm64 platform as a top-tier supported platform, similar to amd64, since containerd has been widely used in the Arm world.</p>
<p>Thanks to Actuated, we, the containerd community, were able to test container features (like mount-idmapping) on the new kernel without significant maintenance overhead for the test infrastructure.
With Actuated, we can focus on open-source deployment to cover more use case scenarios.</p>
</blockquote>
<p>Maintainers have direct access to discuss issues and improvements with us via a private Slack community. One of the things we've done in addition to adding burst capacity to the pool, was <a href="/blog/right-sizing-vms-github-actions">to provide a tool to help teams right-size VMs for jobs</a> and to add support for <a href="/blog/custom-sizes-bpf-kvm">eBPF technologies like BTF</a> in the Kernel.</p>
<h3 id="numbers-at-a-glance">Numbers at a glance</h3>
<p>In our last update, 3 months ago, we'd run just under 400k build minutes for the CNCF. That number has now increased to 1.52M minutes, which is a ~ 300x increase in demand in a short period of time.</p>
<p>Here's a breakdown of the top 9 projects by total minutes run, bearing in mind that this only includes jobs that ran to completion, there are thousands of minutes which ran, but were cancelled mid-way or by automation.</p>
<table>
<thead>
<tr>
<th>Rank</th>
<th>Organisation</th>
<th>Total mins</th>
<th>Total Jobs</th>
<th>First job</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>open-telemetry</td>
<td>593726</td>
<td>40093</td>
<td>2024-02-15</td>
</tr>
<tr>
<td>2</td>
<td>etcd-io</td>
<td>372080</td>
<td>21347</td>
<td>2023-10-24</td>
</tr>
<tr>
<td>3</td>
<td>cri-o</td>
<td>163927</td>
<td>11131</td>
<td>2023-11-27</td>
</tr>
<tr>
<td>4</td>
<td>falcosecurity</td>
<td>138469</td>
<td>13274</td>
<td>2023-12-06</td>
</tr>
<tr>
<td>5</td>
<td>fluent</td>
<td>89856</td>
<td>10658</td>
<td>2023-06-07</td>
</tr>
<tr>
<td>6</td>
<td>containerd</td>
<td>87007</td>
<td>11192</td>
<td>2023-12-02</td>
</tr>
<tr>
<td>7</td>
<td>cilium</td>
<td>73406</td>
<td>6252</td>
<td>2023-10-31</td>
</tr>
<tr>
<td>8</td>
<td>opencontainers</td>
<td>3716</td>
<td>458</td>
<td>2023-12-15</td>
</tr>
<tr>
<td>9</td>
<td>argoproj</td>
<td>187</td>
<td>12</td>
<td>2024-01-30</td>
</tr>
<tr>
<td>(all)</td>
<td>(Total)</td>
<td>1520464</td>
<td>116217</td>
<td></td>
</tr>
</tbody>
</table>
<p>Most organisations build for several projects or repositories. In the case of etcd, the numbers also include the boltdb project, and for cilium, tetragon, and the Go bindings for ebpf are also included. Open Telemetry is mainly focused around the <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib">collectors and SDKs</a>.</p>
<p>runc which is within the opencontainers organisation is technically an Open Container Initiative (OCI) project under the LinuxFoundation, rather than a CNCF project, but we gave them access since it is a key dependency for containerd and cri-o.</p>
<h2 id="whats-next">What's next?</h2>
<p>With the exception of Argo, all of the projects are now relatively heavy users of the platform, with demand growing month on month, as you can see from the uptick from 389k minutes in March to a record high of 1.52 million minutes by the end of May of the same year. In the case of Argo, if you're a contributor or have done previous open source enablement, perhaps you could help them expand their Arm support via a series of <a href="https://github.com/argoproj/argo-cd/issues/9012">Pull Requests to enable unit/e2e tests to run on Arm64</a>?</p>
<p>We're continuing to improve the platform to support users during peak demand, outages on GitHub, and to provide a reliable way for CNCF projects to run their CI on real Arm hardware, at full speed.</p>
<p>For instance, last month we just released a new 6.1 Kernel for the Ampere Altra, which means projects like Cilium and Falco can make use of new eBPF features introduced in recent Kernel versions, and will bring support for newer Kernels as the Firecracker team make them available. The runc and container teams also benefit from the newer Kernel and have been able to enable further tests for (Checkpoint/Restore In Userspace) CRIU and User namespaces for containerd.</p>
<p>You can watch the interview I mentioned earlier with Chris, Ed, Dave and myself on YouTube:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/sv3jtSvW9gk?si=2PVUFCx_QUt65v5-" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<h3 id="we-could-help-you-too">We could help you too</h3>
<p>Actuated can manage x86 and Arm64 servers for GitHub Actions and <a href="/blog/secure-microvm-ci-gitlab">self-managed GitLab CI</a>. If you'd like to speak to us about how we can speed up your jobs, reduce your maintenance efforts and lower your CI costs, <a href="https://actuated.com/pricing/">reach out via this page</a>.</p></div></div></main><footer class="bg-white"><div class="mx-auto max-w-7xl py-12 px-4 sm:px-6 md:flex md:items-center md:justify-between lg:px-8"><div class="flex justify-center space-x-6 md:order-2"><a class="text-gray-400 hover:text-gray-500" href="https://twitter.com/selfactuated"><span class="sr-only">Twitter</span><svg fill="currentColor" viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg></a><a class="text-gray-400 hover:text-gray-500" href="https://github.com/self-actuated"><span class="sr-only">GitHub</span><svg fill="currentColor" viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg></a><a class="text-gray-400 hover:text-gray-500" href="/rss.xml"><span class="sr-only">RSS</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"></path></svg></a></div><div class="mt-8 md:order-1 md:mt-0"><p class="text-center text-base text-gray-400">© 2024 <a href="https://openfaas.com">OpenFaaS Ltd</a>. All rights reserved. <a class="hover:underline" href="/terms">Terms &amp; Conditions.</a></p></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"millions-of-cncf-minutes","fileName":"2024-05-30-millions-of-cncf-minutes.md","contentHtml":"\u003cp\u003eIn this post I'll cover:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWho's the program to bring actuated to the CNCF\u003c/li\u003e\n\u003cli\u003eA new video interview with our team, the CNCF, Ampere and Equinix Metal\u003c/li\u003e\n\u003cli\u003eWhat options teams had for Arm both and then after the program\u003c/li\u003e\n\u003cli\u003eThe high level numbers, and how that's split over the top 9 projects\u003c/li\u003e\n\u003cli\u003eWhat's next for the program\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"whats-actuated\"\u003eWhat's Actuated?\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eActuated is the only solution that gives a managed experience for self-hosted runners, on your own hardware through immutable microVMs.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThe immutability is key to both security and reliability. Each build is run in its own ephemeral and immutable microVM, meaning side effects cannot be left behind by prior builds. In addition, our team manages reliability for your servers and the integration with GitHub, for minimal disruption during GitHub outages.\u003c/p\u003e\n\u003ch2 id=\"why-did-the-cncf-want-actuated-for-its-projects\"\u003eWhy did the CNCF want Actuated for its projects?\u003c/h2\u003e\n\u003cp\u003eWe've been working with \u003ca href=\"https://amperecomputing.com/\"\u003eAmpere\u003c/a\u003e and \u003ca href=\"https://deploy.equinix.com/\"\u003eEquinix Metal\u003c/a\u003e to provide CI via GitHub Actions for Cloud Native Computing (CNCF) projects. Ampere manufacture Arm-based CPUs with a focus on efficiency and high core density. Equinix Metal provide access to the Ampere Altra in their datacenters around the world.\u003c/p\u003e\n\u003cp\u003eLast December, we met with \u003ca href=\"https://www.linkedin.com/in/caniszczyk/\"\u003eChris Aniszczyck\u003c/a\u003e - CTO Linux Foundation/CNCF, \u003ca href=\"https://www.linkedin.com/in/edwardvielmetti/\"\u003eEd Vielmetti\u003c/a\u003e - Open Source Manager Equinix, \u003ca href=\"https://www.linkedin.com/in/dneary/\"\u003eDave Neary\u003c/a\u003e - Director of Developer Relations at Ampere and myself to discuss the program and what impact it was having so far.\u003c/p\u003e\n\u003cp\u003eWatch the recap on YouTube: \u003ca href=\"https://www.youtube.com/watch?v=sv3jtSvW9gk\"\u003eThe Ampere Developer Impact: CNCF Pilot Discussion\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ePast articles on the blog include:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOctober 2023 launch - \u003ca href=\"/blog/arm-ci-cncf-ampere\"\u003eAnnouncing managed Arm CI for CNCF projects\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMarch 2024 update - \u003ca href=\"/blog/cncf-arm-march-update\"\u003eThe state of Arm CI for the CNCF\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"before-and-after-the-program\"\u003eBefore and after the program\u003c/h2\u003e\n\u003cp\u003eBefore we started the program, CNCF projects could be divided into three buckets:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThey were running Arm-based CI jobs on static servers that they managed\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eIn this case, etcd for instance had a team of half a dozen maintainers who were responsible for setting up, maintaining, and upgrading statically provisioned CI servers for the project. This was a significant overhead for the project maintainers, and the servers were often underutilized. The risk of side-effects being left behind between builds also posed a serious supply chain risk since etcd is consumed in virtually every Kubernetes deployment.\u003c/p\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eThey were running Arm-based CI using emulation (QEMU)\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eQEMU can be combined with Docker's buildx for a quick and convenient way to build container images for x86 and Arm architectures. In the best case, it's a small change and may add a few minutes of extra overhead. In the worst case, we saw that jobs that ran in ~ 5 minutes, took over 6 hours to complete using QEMU and hosted runners. A prime example was fluentd, read their case-study here: \u003ca href=\"https://calyptia.com/blog/scaling-builds-with-actuated\"\u003eScaling ARM builds with Actuated\u003c/a\u003e\u003c/p\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eThey had no Arm CI at all\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eIn the third case, we saw projects like OpenTelemetry which had no support for Arm at all, but demand from their community to bring it up to on par with x86 builds. The need to self-manage insecure CI servers meant that Arm was a blocker for them.\u003c/p\u003e\n\u003ch3 id=\"after-the-program\"\u003eAfter the program\u003c/h3\u003e\n\u003cp\u003eAfter the program was live, teams who had been maintaining their own servers got to remove lengthy documentation on server configuration and maintenance, and relied on our team to manage a pool of servers used for scheduling microVMs.\u003c/p\u003e\n\u003cp\u003eAs demand grew, we saw OpenTelemetry and etcd starve the shared pool of resources through very high usage patterns. This is a classic and known problem called \"Tragedy of the Commons\" - when a shared resource is overused by a subset of users, it can lead to a degradation of service for all users. To combat the problem, we added code to provision self-destructing servers for a period of 24-48 hours as need arose, and prevented the higher usage projects from running on at least on of the permanent servers through scheduling rules. One other issue we saw with OpenTelemetry in particular was that the various Go proxies that offer up Go modules appeared to be rejecting requests when too many jobs were running concurrently. As a workaround, we added a private Go proxy for them into the private network space where the CNCF servers run, this also massively reduced the bandwidth costs for the shared infrastructure.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://calyptia.com/blog/scaling-builds-with-actuated\"\u003eTeams like fluent\u003c/a\u003e moved from flakey builds that couldn't finish in 6 hours, to builds that finished in 5-10 minutes. This meant they could expand on their suite of tests.\u003c/p\u003e\n\u003cp\u003eWhere teams such as Cilium, Falco, or OpenTelemetry had no Arm CI support, we saw them quickly ramp up to running thousands of builds per month.\u003c/p\u003e\n\u003cp\u003eHere's a quote from \u003ca href=\"https://www.linkedin.com/in/fededp/\"\u003eFederico Di Pierro\u003c/a\u003e, Senior Open Source Engineer @ Sysdig and maintainer of Falco:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eFalco really needed arm64 GitHub runners to elevate its support for the architecture and enlarge its userbase.\nActuated was the perfect solution for us because it was easy to leverage and relieved any burden for the maintainers. This way, we as maintainers, can focus on what really matters for the project, instead of fighting with maintaining and deploying self-hosted infrastructure.\nNow we are building, testing and releasing artifacts for arm64 leveraging Actuated for many of our projects, and it works flawlessly.\nSupport from Alex's team is always on point, and new kernel features are coming through super quickly!\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/akihirosuda\"\u003eAkihiro Suda\u003c/a\u003e, Software Engineer at NTT Corp, and maintainer of several open source projects including: runc, containerd and lima had this to say:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eHuge thanks to Actuated for enabling us to run ARM64 tests without any mess.\nIt is very important for the runc project to run the tests on ARM64, as runc depends on several architecture-dependent components such as seccomp and criu.\nIt is also so nice that the Arm instance specification can be adjusted in a single line in the GitHub Actions workflow file.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/fuweid\"\u003eWei Fu\u003c/a\u003e, a maintainer for containerd said:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe containerd project was able to test each pull request for the Linux arm64 platform with the support of Actuated.\nIt's a significant step for containerd to mark the Linux arm64 platform as a top-tier supported platform, similar to amd64, since containerd has been widely used in the Arm world.\u003c/p\u003e\n\u003cp\u003eThanks to Actuated, we, the containerd community, were able to test container features (like mount-idmapping) on the new kernel without significant maintenance overhead for the test infrastructure.\nWith Actuated, we can focus on open-source deployment to cover more use case scenarios.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eMaintainers have direct access to discuss issues and improvements with us via a private Slack community. One of the things we've done in addition to adding burst capacity to the pool, was \u003ca href=\"/blog/right-sizing-vms-github-actions\"\u003eto provide a tool to help teams right-size VMs for jobs\u003c/a\u003e and to add support for \u003ca href=\"/blog/custom-sizes-bpf-kvm\"\u003eeBPF technologies like BTF\u003c/a\u003e in the Kernel.\u003c/p\u003e\n\u003ch3 id=\"numbers-at-a-glance\"\u003eNumbers at a glance\u003c/h3\u003e\n\u003cp\u003eIn our last update, 3 months ago, we'd run just under 400k build minutes for the CNCF. That number has now increased to 1.52M minutes, which is a ~ 300x increase in demand in a short period of time.\u003c/p\u003e\n\u003cp\u003eHere's a breakdown of the top 9 projects by total minutes run, bearing in mind that this only includes jobs that ran to completion, there are thousands of minutes which ran, but were cancelled mid-way or by automation.\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eRank\u003c/th\u003e\n\u003cth\u003eOrganisation\u003c/th\u003e\n\u003cth\u003eTotal mins\u003c/th\u003e\n\u003cth\u003eTotal Jobs\u003c/th\u003e\n\u003cth\u003eFirst job\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003eopen-telemetry\u003c/td\u003e\n\u003ctd\u003e593726\u003c/td\u003e\n\u003ctd\u003e40093\u003c/td\u003e\n\u003ctd\u003e2024-02-15\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003eetcd-io\u003c/td\u003e\n\u003ctd\u003e372080\u003c/td\u003e\n\u003ctd\u003e21347\u003c/td\u003e\n\u003ctd\u003e2023-10-24\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003ecri-o\u003c/td\u003e\n\u003ctd\u003e163927\u003c/td\u003e\n\u003ctd\u003e11131\u003c/td\u003e\n\u003ctd\u003e2023-11-27\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003efalcosecurity\u003c/td\u003e\n\u003ctd\u003e138469\u003c/td\u003e\n\u003ctd\u003e13274\u003c/td\u003e\n\u003ctd\u003e2023-12-06\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003efluent\u003c/td\u003e\n\u003ctd\u003e89856\u003c/td\u003e\n\u003ctd\u003e10658\u003c/td\u003e\n\u003ctd\u003e2023-06-07\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003econtainerd\u003c/td\u003e\n\u003ctd\u003e87007\u003c/td\u003e\n\u003ctd\u003e11192\u003c/td\u003e\n\u003ctd\u003e2023-12-02\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003ecilium\u003c/td\u003e\n\u003ctd\u003e73406\u003c/td\u003e\n\u003ctd\u003e6252\u003c/td\u003e\n\u003ctd\u003e2023-10-31\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8\u003c/td\u003e\n\u003ctd\u003eopencontainers\u003c/td\u003e\n\u003ctd\u003e3716\u003c/td\u003e\n\u003ctd\u003e458\u003c/td\u003e\n\u003ctd\u003e2023-12-15\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e9\u003c/td\u003e\n\u003ctd\u003eargoproj\u003c/td\u003e\n\u003ctd\u003e187\u003c/td\u003e\n\u003ctd\u003e12\u003c/td\u003e\n\u003ctd\u003e2024-01-30\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e(all)\u003c/td\u003e\n\u003ctd\u003e(Total)\u003c/td\u003e\n\u003ctd\u003e1520464\u003c/td\u003e\n\u003ctd\u003e116217\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eMost organisations build for several projects or repositories. In the case of etcd, the numbers also include the boltdb project, and for cilium, tetragon, and the Go bindings for ebpf are also included. Open Telemetry is mainly focused around the \u003ca href=\"https://github.com/open-telemetry/opentelemetry-collector-contrib\"\u003ecollectors and SDKs\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003erunc which is within the opencontainers organisation is technically an Open Container Initiative (OCI) project under the LinuxFoundation, rather than a CNCF project, but we gave them access since it is a key dependency for containerd and cri-o.\u003c/p\u003e\n\u003ch2 id=\"whats-next\"\u003eWhat's next?\u003c/h2\u003e\n\u003cp\u003eWith the exception of Argo, all of the projects are now relatively heavy users of the platform, with demand growing month on month, as you can see from the uptick from 389k minutes in March to a record high of 1.52 million minutes by the end of May of the same year. In the case of Argo, if you're a contributor or have done previous open source enablement, perhaps you could help them expand their Arm support via a series of \u003ca href=\"https://github.com/argoproj/argo-cd/issues/9012\"\u003ePull Requests to enable unit/e2e tests to run on Arm64\u003c/a\u003e?\u003c/p\u003e\n\u003cp\u003eWe're continuing to improve the platform to support users during peak demand, outages on GitHub, and to provide a reliable way for CNCF projects to run their CI on real Arm hardware, at full speed.\u003c/p\u003e\n\u003cp\u003eFor instance, last month we just released a new 6.1 Kernel for the Ampere Altra, which means projects like Cilium and Falco can make use of new eBPF features introduced in recent Kernel versions, and will bring support for newer Kernels as the Firecracker team make them available. The runc and container teams also benefit from the newer Kernel and have been able to enable further tests for (Checkpoint/Restore In Userspace) CRIU and User namespaces for containerd.\u003c/p\u003e\n\u003cp\u003eYou can watch the interview I mentioned earlier with Chris, Ed, Dave and myself on YouTube:\u003c/p\u003e\n\u003ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/sv3jtSvW9gk?si=2PVUFCx_QUt65v5-\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen\u003e\u003c/iframe\u003e\n\u003ch3 id=\"we-could-help-you-too\"\u003eWe could help you too\u003c/h3\u003e\n\u003cp\u003eActuated can manage x86 and Arm64 servers for GitHub Actions and \u003ca href=\"/blog/secure-microvm-ci-gitlab\"\u003eself-managed GitLab CI\u003c/a\u003e. If you'd like to speak to us about how we can speed up your jobs, reduce your maintenance efforts and lower your CI costs, \u003ca href=\"https://actuated.com/pricing/\"\u003ereach out via this page\u003c/a\u003e.\u003c/p\u003e","title":"On Running Millions of Arm CI Minutes for the CNCF","description":"We've now run over 1.5 million minutes of CI time for various CNCF projects on Ampere hardware. Here's what we've learned.","tags":["cncf","enablement","arm"],"rollup":true,"author_img":"alex","image":"/images/2024-05-cncf-millions/background.png","date":"2024-05-30"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"millions-of-cncf-minutes"},"buildId":"sjnTidXm8PRh7DDL0ohJw","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>