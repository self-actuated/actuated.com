<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width, initial-scale=1" data-next-head=""/><meta name="theme-color" content="#000000" data-next-head=""/><meta name="author" content="OpenFaaS Ltd" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><title data-next-head="">Egress Filtering for CI to mitigate data exfiltration</title><meta name="description" content="Egress filtering is a security measure that restricts outbound traffic from your CI environment, preventing data exfiltration and ensuring that sensitive information remains secure." data-next-head=""/><meta property="twitter:title" content="Egress Filtering for CI to mitigate data exfiltration" data-next-head=""/><meta property="twitter:description" content="Egress filtering is a security measure that restricts outbound traffic from your CI environment, preventing data exfiltration and ensuring that sensitive information remains secure." data-next-head=""/><meta property="og:title" content="Egress Filtering for CI to mitigate data exfiltration" data-next-head=""/><meta property="og:description" content="Egress filtering is a security measure that restricts outbound traffic from your CI environment, preventing data exfiltration and ensuring that sensitive information remains secure." data-next-head=""/><meta name="twitter:image:src" content="https://actuated.com/images/2025-06-egress/background.png" data-next-head=""/><meta property="og:image" content="https://actuated.com/images/2025-06-egress/background.png" data-next-head=""/><meta charSet="utf-8"/><link rel="icon" type="image/png" href="/images/actuated.png"/><link rel="stylesheet" href="https://rsms.me/inter/inter.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css"/><link rel="manifest" href="/manifest.json"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-M5YNDNX7VT"></script><script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-M5YNDNX7VT');
          </script><link rel="apple-touch-icon" href="/images/actuated.png"/><link rel="preload" href="/_next/static/css/fec1257928618cc8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fec1257928618cc8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-fbb920bddf9bf0a6.js" defer=""></script><script src="/_next/static/chunks/framework-5757d75364ce2279.js" defer=""></script><script src="/_next/static/chunks/main-ef55e8b75fd0cd35.js" defer=""></script><script src="/_next/static/chunks/pages/_app-381d430d4a735a5d.js" defer=""></script><script src="/_next/static/chunks/762-703a014cadea8bf4.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-053ab830ac6cb307.js" defer=""></script><script src="/_next/static/GbsB4mBS6L1JRK0DowxPa/_buildManifest.js" defer=""></script><script src="/_next/static/GbsB4mBS6L1JRK0DowxPa/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-white"><header><div class="relative bg-white" data-headlessui-state=""><div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-6 sm:px-6 md:justify-start md:space-x-10 lg:px-8"><div class="flex justify-start lg:w-0 lg:flex-1"><a href="/"><span class="sr-only">Actuated</span><img class="h-8 w-auto sm:h-10" src="/images/actuated.png" alt="Actuated logo"/></a></div><div class="-my-2 -mr-2 md:hidden"><button class="inline-flex items-center justify-center rounded-md bg-white p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" type="button" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open menu</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button></div><nav class="hidden space-x-10 md:flex"><div class="relative" data-headlessui-state=""><button class="text-gray-500 group inline-flex items-center rounded-md bg-white text-base font-medium hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" type="button" aria-expanded="false" data-headlessui-state=""><span>Solutions</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd"></path></svg></button></div><span hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></span><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/blog">Blog</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/blog/blazing-fast-ci-with-microvms">Announcement</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/pricing">Pricing</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="https://docs.actuated.com/">Docs</a></nav><span hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></span><div class="hidden items-center justify-end md:flex md:flex-1 lg:w-0"><a href="https://dashboard.actuated.com" class="whitespace-nowrap text-base font-medium text-gray-500 hover:text-gray-900">Sign in</a><a href="/pricing" class="ml-8 inline-flex items-center justify-center whitespace-nowrap rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700">Sign-up</a></div></div></div><span hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></span></header><main><div class="container mx-auto max-w-4xl bg-white mt-4 px-4 sm:px-6"><h1 id="post_title" class="text-3xl mb-3 leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl sm:leading-10 text-center">Egress Filtering for CI to mitigate data exfiltration</h1></div><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl"><div class="border-b border-gray-200 py-4 flex items-center text-gray-500 mx-auto"><div><img class="h-10 w-10 rounded-full" src="/images/alex.jpg" alt=""/></div><div class="ml-3"><p id="post_author" class="text-sm leading-5 font-medium text-gray-900"></p><div class="flex text-sm leading-5 text-gray-500"><time dateTime="2025-06-03" id="post_date">June 3, 2025</time><span class="mx-1"></span></div></div></div><div class="mt-6 prose sm:prose-lg max-w-none"><p id="post_description" class="mb-4">Egress filtering is a security measure that restricts outbound traffic from your CI environment, preventing data exfiltration and ensuring that sensitive information remains secure.</p></div><div id="post_content" class="mt-6 prose sm:prose-lg max-w-none"><p>We take at how to implement egress filtering in a CI environment, without relying on a solution that runs within the job itself. This approach is particularly useful for preventing data exfiltration and ensuring that sensitive information remains secure.</p>
<h2 id="introduction">Introduction</h2>
<p>In a time where high-street names, large retailers and airlines are regularly experiencing global outages due to cyber attacks, organisations are asking themselves how they can better protect their data and systems.</p>
<p>The rise of malware, cyber attacks, and ransomware are becoming a major concern for organizations - and rightly so. A single successful attack can lead to significant financial losses, reputational damage, and legal consequences. A notable <a href="https://www.bbc.co.uk/news/articles/c93llkg4n51o">example in the UK is the brand M&#x26;S</a>, which ii likely to suffer disruption to last until July and will cost Â£300m (approx 400m USD).</p>
<p>It's not just big brands - malware is increasingly being included in the software supply chain such as <a href="https://www.akamai.com/blog/security-research/critical-linux-backdoor-xz-utils-discovered-what-to-know">the xz incident</a>, <a href="https://unit42.paloaltonetworks.com/malicious-packages-in-pypi/">malicious packages in PyPy</a>, and <a href="https://www.sonatype.com/blog/multiple-crypto-packages-hijacked-turned-into-info-stealers">npm</a>.</p>
<p>Typically, we would consider a language like Go to be a safe choice, however it is also not immune and has been a target for data exfiltration attacks and <a href="https://thehackernews.com/2025/05/malicious-go-modules-deliver-disk.html">more recently disk wiping</a>.</p>
<p>So what's the answer? There are many - from runtime security measure, to static analysis, to careful control over what software and base images are used within a job.</p>
<p>But many of these measures rely on software executing within the job itself, which means that there is potential for the job to be compromised before the security measures are applied. This is where egress filtering with actuated comes in.</p>
<h2 id="egress-filtering-with-actuated">Egress Filtering with Actuated</h2>
<p>Actuated is a CI solution that provides a secure and ephemeral microVM for each job whether that's for GitHub.com or GitLab CI users.</p>
<p>With a container-based CI solution, you may typically need to run a Kubernetes cluster, and then run a set of long-lived containers within that, which can be compromised over time by side-effects of previous job runs. You may consider using a tool like Istio to implement egress filtering, but it will often get in the way of your other workloads or control-plane components within the cluster.</p>
<p>Not to mention the complexity of setting up and maintaining such a system, and the inherent risk of <a href="/posts/2024-10-23-how-secure-are-containers-vs-microvms-ci/">running containers as privileged or mounting a Docker socket</a>.</p>
<p>The Actuated agent is a lightweight process that runs on a Linux host and is responsible for managing the lifecycle of the microVMs. It provides a secure environment for each job, ensuring that the job runs in isolation and cannot access any sensitive information or resources outside of its own environment.</p>
<p><a href="https://docs.actuated.com/#watch-a-live-demo"><img src="https://docs.actuated.com/images/conceptual-high-level.png" alt=""></a></p>
<blockquote>
<p>The Actuated agent starts a microVM for each job, which is isolated from the host and other jobs. All network access has to go through a special Linux bridge.</p>
</blockquote>
<p>All network traffic from the microVM is routed through a network bridge, which means we can apply policies and control the traffic that is allowed to leave the microVM. This allows us to implement egress filtering without relying on software running within the job itself.</p>
<p>Example of HTTPS filtering for an allowed domain:</p>
<p><img src="/images/2025-06-egress/transparent-https.png" alt="Allowed"></p>
<blockquote>
<p>Pictured: HTTPS request is allowed to egress when it matches the whitelist, otherwise it is blocked. The agent also applies DNS filtering to prevent data exfiltration.</p>
</blockquote>
<p>For a domain that's not in the list:</p>
<p><img src="/images/2025-06-egress/transparent-https.png" alt="Not allowed"></p>
<blockquote>
<p>Pictured: The request to a domain which is not on the whitelist is blocked by the agent, preventing the malware from accessing the remote endpoint.</p>
</blockquote>
<h3 id="the-whitelist">The whitelist</h3>
<p>The most practical form of filtering bans all outgoing TCP and UDP traffic, then allows only a sub-set of whitelisted domains to be accessed, ideally without involving a costly enterprise-grade intercepting HTTPS proxy server such as <a href="https://umbrella.cisco.com/solutions/web-content-filtering">Cisco Umbrella</a> or <a href="https://www.zscaler.com/">Zscaler</a>.</p>
<p>Egress filtering is not for the feint of heart, it requires careful consideration of the traffic that is allowed to leave the microVM - and a basic GitHub Actions job that only prints "Hello World" may genuinely need to access up to 10-20 different domains just to run and publish its built-in telemetry.</p>
<p><img src="/images/2025-06-egress/egress.jpeg" alt="Audit-only mode"></p>
<blockquote>
<p>Pictured: a build that starts a K3s cluster, something which is not possible on Kubernetes without resorting to privileged containers or mounting the Docker socket.</p>
</blockquote>
<p>A practical whitelist may look like this for a very minimal build:</p>
<p><em><code>/etc/actuated-egress/whitelist.yaml</code></em></p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">allowed_domains:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">api.github.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">gitlab.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">github.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">google.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">archive.ubuntu.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">security.ubuntu.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">'*.actions.githubusercontent.com'</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">checkip.amazonaws.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">'*.blob.core.windows.net'</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">raw.githubusercontent.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">codeload.github.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">objects.githubusercontent.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">deb.nodesource.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">download.docker.com</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">trafficmanager.net</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">a2z.com</span>
<span class="hljs-comment"># Custom entries for our usage</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">get.arkade.dev</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">openfaas-live.actuated.dev</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"*.o6s.io"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"*.openfaas.com"</span> 
</code></pre>
<p>To build the list, you can set actuated to run in audit-only mode.</p>
<p><em><code>/etc/default/actuated-egress</code></em></p>
<pre><code>AUDIT_MODE="true"
COREFILE="/etc/coredns/Corefile"
WHITELIST="/etc/actuated-egress/whitelist.yaml"
LOGS_PATH="/var/log/actuated-egress"
</code></pre>
<p>Instead of blocking traffic not present within the whitelist, it will log the domains accessed to a file in: <code>/var/log/actuated-egress</code>.</p>
<p>You can then run a well-known job, gather the list of domains, assess them one-by-one and add any required.</p>
<p>Then flip the <code>AUDIT_MODE</code> to <code>false</code> and restart the agent - at this point, you can try to run the job again to see if it works as expected.</p>
<h3 id="8020-principle">80/20 principle</h3>
<p>Whilst you could purchase a costly web-filtering solution such as the ones mentioned above to look at layer 7 traffic - this requires that every process in the job is proxy-aware, and can be configured to use a HTTP proxy. That's not often the case with Linux-based software, and it is a serious pain to configure.</p>
<p>Instead, we can rely on actuated's transparent HTTPS proxying and DNS filtering to provide a solid level of protection against data exfiltration, without overwhelming the user with configuration.</p>
<p>First, all traffic outgoing from the VM is blocked and denied by default.</p>
<p>Then, all traffic to port 80 and 443 is transparently redirected to actuated's agent, which applies the whitelist we've already explored.</p>
<p>Next, ICMP, UDP and other non-TCP traffic is blocked by default, and then DNS traffic is again, re-routed to actuated's agent, which applies the same whitelist to the DNS queries.</p>
<p>This means, that if an npm package, PiPy package, or Go module tries to access a domain that is not on the whitelist to exfiltrate a credential or source code, it will be blocked by the agent.</p>
<h3 id="conclusion">Conclusion</h3>
<p>When you combine a ephemeral microVM with egress filtering, you can create a secure CI environment that is resistant to many kinds of data exfiltration and malware attacks.</p>
<p>Unlike with containers and Kubernetes, the one-shot microVMs used by actuated have their own guest Kernel so they can run Docker, Kubernetes, even custom Kernel modules without any risk to the host or other jobs.</p>
<p>Then a default deny for all outgoing network traffic, combined with restrictive whitelisting of domains applies the 80/20 principle to egress filtering, allowing you to run jobs without needing to configure a complex proxy or web-filtering solution.</p>
<p>If you'd like to talk to us or find out more: <a href="https://actuated.com/pricing">contact us here</a>.</p>
<p>You can watch a demo below of the filtering in action:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/L1iOmwquNVg?si=H9xxBe6mvC5F5V1Y" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe></div></div></main><footer class="bg-white"><div class="mx-auto max-w-7xl py-12 px-4 sm:px-6 md:flex md:items-center md:justify-between lg:px-8"><div class="flex justify-center space-x-6 md:order-2"><a class="text-gray-400 hover:text-gray-500" href="https://twitter.com/selfactuated"><span class="sr-only">Twitter</span><svg fill="currentColor" viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg></a><a class="text-gray-400 hover:text-gray-500" href="https://github.com/self-actuated"><span class="sr-only">GitHub</span><svg fill="currentColor" viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg></a><a class="text-gray-400 hover:text-gray-500" href="/rss.xml"><span class="sr-only">RSS</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"></path></svg></a></div><div class="mt-8 md:order-1 md:mt-0"><p class="text-center text-base text-gray-400">Â© 2024 <a href="https://openfaas.com">OpenFaaS Ltd</a>. All rights reserved. <a class="hover:underline" href="/terms">Terms &amp; Conditions.</a></p></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"egress-filtering","fileName":"2025-06-03-egress-filtering.md","contentHtml":"\u003cp\u003eWe take at how to implement egress filtering in a CI environment, without relying on a solution that runs within the job itself. This approach is particularly useful for preventing data exfiltration and ensuring that sensitive information remains secure.\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eIn a time where high-street names, large retailers and airlines are regularly experiencing global outages due to cyber attacks, organisations are asking themselves how they can better protect their data and systems.\u003c/p\u003e\n\u003cp\u003eThe rise of malware, cyber attacks, and ransomware are becoming a major concern for organizations - and rightly so. A single successful attack can lead to significant financial losses, reputational damage, and legal consequences. A notable \u003ca href=\"https://www.bbc.co.uk/news/articles/c93llkg4n51o\"\u003eexample in the UK is the brand M\u0026#x26;S\u003c/a\u003e, which ii likely to suffer disruption to last until July and will cost Â£300m (approx 400m USD).\u003c/p\u003e\n\u003cp\u003eIt's not just big brands - malware is increasingly being included in the software supply chain such as \u003ca href=\"https://www.akamai.com/blog/security-research/critical-linux-backdoor-xz-utils-discovered-what-to-know\"\u003ethe xz incident\u003c/a\u003e, \u003ca href=\"https://unit42.paloaltonetworks.com/malicious-packages-in-pypi/\"\u003emalicious packages in PyPy\u003c/a\u003e, and \u003ca href=\"https://www.sonatype.com/blog/multiple-crypto-packages-hijacked-turned-into-info-stealers\"\u003enpm\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eTypically, we would consider a language like Go to be a safe choice, however it is also not immune and has been a target for data exfiltration attacks and \u003ca href=\"https://thehackernews.com/2025/05/malicious-go-modules-deliver-disk.html\"\u003emore recently disk wiping\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eSo what's the answer? There are many - from runtime security measure, to static analysis, to careful control over what software and base images are used within a job.\u003c/p\u003e\n\u003cp\u003eBut many of these measures rely on software executing within the job itself, which means that there is potential for the job to be compromised before the security measures are applied. This is where egress filtering with actuated comes in.\u003c/p\u003e\n\u003ch2 id=\"egress-filtering-with-actuated\"\u003eEgress Filtering with Actuated\u003c/h2\u003e\n\u003cp\u003eActuated is a CI solution that provides a secure and ephemeral microVM for each job whether that's for GitHub.com or GitLab CI users.\u003c/p\u003e\n\u003cp\u003eWith a container-based CI solution, you may typically need to run a Kubernetes cluster, and then run a set of long-lived containers within that, which can be compromised over time by side-effects of previous job runs. You may consider using a tool like Istio to implement egress filtering, but it will often get in the way of your other workloads or control-plane components within the cluster.\u003c/p\u003e\n\u003cp\u003eNot to mention the complexity of setting up and maintaining such a system, and the inherent risk of \u003ca href=\"/posts/2024-10-23-how-secure-are-containers-vs-microvms-ci/\"\u003erunning containers as privileged or mounting a Docker socket\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe Actuated agent is a lightweight process that runs on a Linux host and is responsible for managing the lifecycle of the microVMs. It provides a secure environment for each job, ensuring that the job runs in isolation and cannot access any sensitive information or resources outside of its own environment.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://docs.actuated.com/#watch-a-live-demo\"\u003e\u003cimg src=\"https://docs.actuated.com/images/conceptual-high-level.png\" alt=\"\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe Actuated agent starts a microVM for each job, which is isolated from the host and other jobs. All network access has to go through a special Linux bridge.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAll network traffic from the microVM is routed through a network bridge, which means we can apply policies and control the traffic that is allowed to leave the microVM. This allows us to implement egress filtering without relying on software running within the job itself.\u003c/p\u003e\n\u003cp\u003eExample of HTTPS filtering for an allowed domain:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2025-06-egress/transparent-https.png\" alt=\"Allowed\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ePictured: HTTPS request is allowed to egress when it matches the whitelist, otherwise it is blocked. The agent also applies DNS filtering to prevent data exfiltration.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eFor a domain that's not in the list:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2025-06-egress/transparent-https.png\" alt=\"Not allowed\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ePictured: The request to a domain which is not on the whitelist is blocked by the agent, preventing the malware from accessing the remote endpoint.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"the-whitelist\"\u003eThe whitelist\u003c/h3\u003e\n\u003cp\u003eThe most practical form of filtering bans all outgoing TCP and UDP traffic, then allows only a sub-set of whitelisted domains to be accessed, ideally without involving a costly enterprise-grade intercepting HTTPS proxy server such as \u003ca href=\"https://umbrella.cisco.com/solutions/web-content-filtering\"\u003eCisco Umbrella\u003c/a\u003e or \u003ca href=\"https://www.zscaler.com/\"\u003eZscaler\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eEgress filtering is not for the feint of heart, it requires careful consideration of the traffic that is allowed to leave the microVM - and a basic GitHub Actions job that only prints \"Hello World\" may genuinely need to access up to 10-20 different domains just to run and publish its built-in telemetry.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2025-06-egress/egress.jpeg\" alt=\"Audit-only mode\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ePictured: a build that starts a K3s cluster, something which is not possible on Kubernetes without resorting to privileged containers or mounting the Docker socket.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eA practical whitelist may look like this for a very minimal build:\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e\u003ccode\u003e/etc/actuated-egress/whitelist.yaml\u003c/code\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eallowed_domains:\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eapi.github.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egitlab.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egithub.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egoogle.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003earchive.ubuntu.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecurity.ubuntu.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'*.actions.githubusercontent.com'\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003echeckip.amazonaws.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'*.blob.core.windows.net'\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eraw.githubusercontent.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecodeload.github.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eobjects.githubusercontent.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edeb.nodesource.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edownload.docker.com\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etrafficmanager.net\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ea2z.com\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# Custom entries for our usage\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eget.arkade.dev\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eopenfaas-live.actuated.dev\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"*.o6s.io\"\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"*.openfaas.com\"\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo build the list, you can set actuated to run in audit-only mode.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e\u003ccode\u003e/etc/default/actuated-egress\u003c/code\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eAUDIT_MODE=\"true\"\nCOREFILE=\"/etc/coredns/Corefile\"\nWHITELIST=\"/etc/actuated-egress/whitelist.yaml\"\nLOGS_PATH=\"/var/log/actuated-egress\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eInstead of blocking traffic not present within the whitelist, it will log the domains accessed to a file in: \u003ccode\u003e/var/log/actuated-egress\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eYou can then run a well-known job, gather the list of domains, assess them one-by-one and add any required.\u003c/p\u003e\n\u003cp\u003eThen flip the \u003ccode\u003eAUDIT_MODE\u003c/code\u003e to \u003ccode\u003efalse\u003c/code\u003e and restart the agent - at this point, you can try to run the job again to see if it works as expected.\u003c/p\u003e\n\u003ch3 id=\"8020-principle\"\u003e80/20 principle\u003c/h3\u003e\n\u003cp\u003eWhilst you could purchase a costly web-filtering solution such as the ones mentioned above to look at layer 7 traffic - this requires that every process in the job is proxy-aware, and can be configured to use a HTTP proxy. That's not often the case with Linux-based software, and it is a serious pain to configure.\u003c/p\u003e\n\u003cp\u003eInstead, we can rely on actuated's transparent HTTPS proxying and DNS filtering to provide a solid level of protection against data exfiltration, without overwhelming the user with configuration.\u003c/p\u003e\n\u003cp\u003eFirst, all traffic outgoing from the VM is blocked and denied by default.\u003c/p\u003e\n\u003cp\u003eThen, all traffic to port 80 and 443 is transparently redirected to actuated's agent, which applies the whitelist we've already explored.\u003c/p\u003e\n\u003cp\u003eNext, ICMP, UDP and other non-TCP traffic is blocked by default, and then DNS traffic is again, re-routed to actuated's agent, which applies the same whitelist to the DNS queries.\u003c/p\u003e\n\u003cp\u003eThis means, that if an npm package, PiPy package, or Go module tries to access a domain that is not on the whitelist to exfiltrate a credential or source code, it will be blocked by the agent.\u003c/p\u003e\n\u003ch3 id=\"conclusion\"\u003eConclusion\u003c/h3\u003e\n\u003cp\u003eWhen you combine a ephemeral microVM with egress filtering, you can create a secure CI environment that is resistant to many kinds of data exfiltration and malware attacks.\u003c/p\u003e\n\u003cp\u003eUnlike with containers and Kubernetes, the one-shot microVMs used by actuated have their own guest Kernel so they can run Docker, Kubernetes, even custom Kernel modules without any risk to the host or other jobs.\u003c/p\u003e\n\u003cp\u003eThen a default deny for all outgoing network traffic, combined with restrictive whitelisting of domains applies the 80/20 principle to egress filtering, allowing you to run jobs without needing to configure a complex proxy or web-filtering solution.\u003c/p\u003e\n\u003cp\u003eIf you'd like to talk to us or find out more: \u003ca href=\"https://actuated.com/pricing\"\u003econtact us here\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eYou can watch a demo below of the filtering in action:\u003c/p\u003e\n\u003ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/L1iOmwquNVg?si=H9xxBe6mvC5F5V1Y\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen\u003e\u003c/iframe\u003e","title":"Egress Filtering for CI to mitigate data exfiltration","description":"Egress filtering is a security measure that restricts outbound traffic from your CI environment, preventing data exfiltration and ensuring that sensitive information remains secure.","tags":["security","containers","firecracker","egress"],"author_img":"alex","image":"/images/2025-06-egress/background.png","date":"2025-06-03"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"egress-filtering"},"buildId":"GbsB4mBS6L1JRK0DowxPa","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>