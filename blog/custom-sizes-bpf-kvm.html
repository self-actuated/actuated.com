<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="theme-color" content="#000000"/><meta name="author" content="OpenFaaS Ltd"/><meta name="twitter:card" content="summary_large_image"/><title>December Boost: Custom Job Sizes, eBPF Support &amp; KVM Acceleration</title><meta name="description" content="You can now request custom amounts of RAM and vCPU for jobs, run eBPF within jobs, and use KVM acceleration."/><meta property="twitter:title" content="December Boost: Custom Job Sizes, eBPF Support &amp; KVM Acceleration"/><meta property="twitter:description" content="You can now request custom amounts of RAM and vCPU for jobs, run eBPF within jobs, and use KVM acceleration."/><meta property="og:title" content="December Boost: Custom Job Sizes, eBPF Support &amp; KVM Acceleration"/><meta property="og:description" content="You can now request custom amounts of RAM and vCPU for jobs, run eBPF within jobs, and use KVM acceleration."/><meta name="twitter:image:src" content="https://actuated.dev/images/2023-12-scheduling-bpf/background-bpf.png"/><meta property="og:image" content="https://actuated.dev/images/2023-12-scheduling-bpf/background-bpf.png"/><meta name="next-head-count" content="13"/><meta charSet="utf-8"/><link rel="icon" type="image/png" href="/images/actuated.png"/><link rel="stylesheet" href="https://rsms.me/inter/inter.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css"/><link rel="manifest" href="/manifest.json"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-M5YNDNX7VT"></script><script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-M5YNDNX7VT');
          </script><link rel="apple-touch-icon" href="/images/actuated.png"/><link rel="preload" href="/_next/static/css/835182c647a0329c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/835182c647a0329c.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-34e2100d07ae5757.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ba4f0f0b110ca3d9.js" defer=""></script><script src="/_next/static/chunks/552-542f150c917a7625.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-109b0d2eddac75b5.js" defer=""></script><script src="/_next/static/X_ZN51fuHqgIS_lYwh_px/_buildManifest.js" defer=""></script><script src="/_next/static/X_ZN51fuHqgIS_lYwh_px/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-white"><header><div class="relative bg-white" data-headlessui-state=""><div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-6 sm:px-6 md:justify-start md:space-x-10 lg:px-8"><div class="flex justify-start lg:w-0 lg:flex-1"><a href="/"><span class="sr-only">Actuated</span><img class="h-8 w-auto sm:h-10" src="/images/actuated.png" alt="Actuated logo"/></a></div><div class="-my-2 -mr-2 md:hidden"><button class="inline-flex items-center justify-center rounded-md bg-white p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" type="button" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open menu</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button></div><nav class="hidden space-x-10 md:flex"><div class="relative" data-headlessui-state=""><button class="text-gray-500 group inline-flex items-center rounded-md bg-white text-base font-medium hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" type="button" aria-expanded="false" data-headlessui-state=""><span>Solutions</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd"></path></svg></button></div><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/blog">Blog</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="https://actuated.dev/blog/blazing-fast-ci-with-microvms">Announcement</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/pricing">Pricing</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="https://docs.actuated.dev/">Docs</a></nav><div class="hidden items-center justify-end md:flex md:flex-1 lg:w-0"><a href="https://dashboard.actuated.dev" class="whitespace-nowrap text-base font-medium text-gray-500 hover:text-gray-900">Sign in</a><a href="/pricing" class="ml-8 inline-flex items-center justify-center whitespace-nowrap rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700">Sign-up</a></div></div></div></header><main><div class="container mx-auto max-w-4xl bg-white mt-4 px-4 sm:px-6"><h1 id="post_title" class="text-3xl mb-3 leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl sm:leading-10 text-center">December Boost: Custom Job Sizes, eBPF Support &amp; KVM Acceleration</h1></div><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl"><div class="border-b border-gray-200 py-4 flex items-center text-gray-500 mx-auto"><div><img class="h-10 w-10 rounded-full" src="/images/alex.jpg" alt=""/></div><div class="ml-3"><p id="post_author" class="text-sm leading-5 font-medium text-gray-900"></p><div class="flex text-sm leading-5 text-gray-500"><time dateTime="2023-12-04" id="post_date">December 4, 2023</time><span class="mx-1"></span></div></div></div><div class="mt-6 prose sm:prose-lg max-w-none"><p id="post_description" class="mb-4">You can now request custom amounts of RAM and vCPU for jobs, run eBPF within jobs, and use KVM acceleration.</p></div><div id="post_content" class="mt-6 prose sm:prose-lg max-w-none"><p>In this December update, we've got three new updates to the platform that we think you'll benefit from. From requesting custom vCPU and RAM per job, to eBPF features, to spreading your plan across multiple machines dynamically, it's all new and makes actuated better value.</p>
<h2>New eBPF support and 5.10.201 Kernel</h2>
<p>And as part of our work to provide hosted <a href="/blog/arm-ci-cncf-ampere">Arm CI for CNCF projects</a>, including <a href="https://github.com/cilium/tetragon">Tetragon</a> and <a href="https://github.com/cilium/cilium">Cilium</a>, we've now enabled eBPF and BTF features within the Kernel.</p>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Berkeley_Packet_Filter">Berkley Packet Filter (BPF)</a> is an advanced way to integrate with the Kernel, for observability, security and networking. You'll see it included in various CNCF projects like Cilium, <a href="https://github.com/falcosecurity/falco">Falco</a>, <a href="https://www.cncf.io/projects/kepler/">Kepler</a>, and others.</p>
</blockquote>
<p>Whilst BPF is powerful, it's also a very fast moving space, and was particularly complicated to patch to Firecracker's minimal Kernel configuration. We want to say a thank you to <a href="https://twitter.com/mtardy_?lang=en">Mah√© Tardy
</a> who maintains Tetragon and to <a href="https://www.linkedin.com/in/mauilion">Duffie Coolie</a> both from <a href="https://isovalent.com/">Isovalent</a> for pointers and collaboration.</p>
<p>We've made a big jump in the supported Kernel version from 5.10.77 up to 5.10.201, with newer revisions being made available on a continual basis.</p>
<p>To update your servers, log in via SSH and edit <code>/etc/default/actuated</code>.</p>
<p>For amd64:</p>
<pre><code>AGENT_IMAGE_REF="ghcr.io/openfaasltd/actuated-ubuntu22.04:x86_64-latest"
AGENT_KERNEL_REF="ghcr.io/openfaasltd/actuated-kernel:x86_64-latest"
</code></pre>
<p>For arm64:</p>
<pre><code>AGENT_IMAGE_REF="ghcr.io/openfaasltd/actuated-ubuntu22.04:aarch64-latest"
AGENT_KERNEL_REF="ghcr.io/openfaasltd/actuated-kernel:aarch64-latest"
</code></pre>
<p>Once you have the new images in place, reboot the server. Updates to the Kernel and root filesystem will be delivered Over The Air (OTA) automatically by our team.</p>
<h2>Request custom vCPU and RAM per job</h2>
<p>Our initial version of actuated aimed to set a specific vCPU and RAM value for each build, designed to slice up a machine equally for the best mix of performance and concurrency. We would recommend it to teams during their onboarding call, then mostly leave it as it was. For a machine with 128GB RAM and 32 threads, you may have set it up for 8 jobs with 4x vCPU and 16GB RAM each, or 4 jobs with 8x vCPU and 32GB RAM.</p>
<p>However, whilst working with Justin Gray, CTO at Toolpath, we found that their build needed increasing amounts of RAM to avoid an Out Of Memory (OOM) crash, and so implemented custom labels.</p>
<p>These labels do not have any predetermined values, so you can change them to any value you like, independently. You're not locked into a set combinations.</p>
<p>Small tasks, automation, publishing Helm charts?</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">runs-on:</span> <span class="hljs-string">actuated-2cpu-8gb</span>
</code></pre>
<p>Building a large application, or training an AI model?</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">runs-on:</span> <span class="hljs-string">actuated-32cpu-128gb</span>
</code></pre>
<h2>Spreading your plan across all available hosts</h2>
<p>Previously, if you had a plan with 10 concurrent builds and both an Arm server and an amd64 server, we'd split your plan statically 50/50. So you could run a maximum of 5 Arm and 5 amd64 builds at the same time.</p>
<p>Now, we've made this dynamic, all of your 10 builds can start on the Arm or amd64 server. Or, 1 could start on the Arm server, then 9 on the amd64 server, and so on.</p>
<p>The change makes the product better value for money, and we had always wanted it to work this way.</p>
<p>Thanks to <a href="https://uk.linkedin.com/in/patrickjkstephens">Patrick Stephens at Fluent/Calyptia</a> for the suggestion and for helping us test it out.</p>
<h2>KVM acceleration aka running VMs in your CI pipeline</h2>
<p>When we started actuated over 12 months ago, there was no support for using KVM acceleration, or running a VM within a GitHub Actions job within GitHub's infrastructure. We made it available for our customers first, with a custom Kernel configuration for <em>x86_64</em> servers. Arm support for launching VMs within VMs is not currently available in the current generation of Ampere servers, but may be available within the next generation of chips and Kernels.</p>
<p>We have several tutorials including how to run Firecracker itself within a CI job, Packer, Nix and more.</p>
<p>When you run Packer in a VM, instead of with one of the cloud drivers, you save on time and costs, by not having to fire up cloud resources on AWS, GCP, Azure, and so forth. Instead, you can run a local VM to build the image, then convert it to an AMI or another format.</p>
<p>One of our customers has started exploring launching a VM during a CI job in order to test air-gapped support for enterprise customers. This is a great example of how you can use nested virtualisation to test your own product in a repeatable way.</p>
<p>Nix benefits particularly from being able to create a clean, isolated environment within a CI pipeline, to get a repeatable build. <a href="https://twitter.com/grhmc">Graham Christensen</a> from <a href="https://github.com/determinateSystems/nix-installer-action">Determinate Systems reached out to collaborate on testing their Nix installer</a> in actuated.</p>
<p>He didn't expect it to run, but when it worked first time, he remarked: "Perfect! I'm impressed and happy that our action works out of the box."</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">specs:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">ci</span>
    <span class="hljs-attr">runs-on:</span> [<span class="hljs-string">actuated-16cpu-32gb</span>]
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">DeterminateSystems/nix-installer-action@main</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">|
            nix-build '&#x3C;nixpkgs/nixos/tests/doas.nix>'
</span></code></pre>
<ul>
<li><a href="https://actuated.dev/blog/kvm-in-github-actions">How to run KVM guests in your GitHub Actions</a></li>
<li><a href="https://actuated.dev/blog/automate-packer-qemu-image-builds">Automate Packer Images with QEMU and Actuated</a></li>
<li><a href="https://actuated.dev/blog/faster-nix-builds">Faster Nix builds with GitHub Actions and actuated</a></li>
<li><a href="https://docs.actuated.dev/examples/kvm-guest">Docs: Run a KVM guest</a></li>
</ul>
<h2>Wrapping up</h2>
<p>We've now released eBPF/BTF support as part of onboarding CNCF projects, updated to the latest Kernel revision, made scheduling better value for money &#x26; easier to customise, and have added a range of tutorials for getting the most out of nested virtualisation.</p>
<p>If you'd like to try out actuated, you can get started same day.</p>
<p><a href="/pricing">Talk to us.</a>.</p>
<p>You may also like:</p>
<ul>
<li><a href="/blog/arm-ci-cncf-ampere">Announcing managed Arm CI for CNCF projects</a></li>
<li><a href="https://docs.actuated.dev/">Actuated docs &#x26; FAQ</a></li>
</ul></div></div></main><footer class="bg-white"><div class="mx-auto max-w-7xl py-12 px-4 sm:px-6 md:flex md:items-center md:justify-between lg:px-8"><div class="flex justify-center space-x-6 md:order-2"><a class="text-gray-400 hover:text-gray-500" href="https://twitter.com/selfactuated"><span class="sr-only">Twitter</span><svg fill="currentColor" viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg></a><a class="text-gray-400 hover:text-gray-500" href="https://github.com/self-actuated"><span class="sr-only">GitHub</span><svg fill="currentColor" viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg></a><a class="text-gray-400 hover:text-gray-500" href="/rss.xml"><span class="sr-only">RSS</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"></path></svg></a></div><div class="mt-8 md:order-1 md:mt-0"><p class="text-center text-base text-gray-400">¬© 2022 <a href="https://openfaas.com">OpenFaaS Ltd</a>, Inc. All rights reserved.</p></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"custom-sizes-bpf-kvm","fileName":"2023-12-04-custom-sizes-bpf-kvm.md","contentHtml":"\u003cp\u003eIn this December update, we've got three new updates to the platform that we think you'll benefit from. From requesting custom vCPU and RAM per job, to eBPF features, to spreading your plan across multiple machines dynamically, it's all new and makes actuated better value.\u003c/p\u003e\n\u003ch2\u003eNew eBPF support and 5.10.201 Kernel\u003c/h2\u003e\n\u003cp\u003eAnd as part of our work to provide hosted \u003ca href=\"/blog/arm-ci-cncf-ampere\"\u003eArm CI for CNCF projects\u003c/a\u003e, including \u003ca href=\"https://github.com/cilium/tetragon\"\u003eTetragon\u003c/a\u003e and \u003ca href=\"https://github.com/cilium/cilium\"\u003eCilium\u003c/a\u003e, we've now enabled eBPF and BTF features within the Kernel.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Berkeley_Packet_Filter\"\u003eBerkley Packet Filter (BPF)\u003c/a\u003e is an advanced way to integrate with the Kernel, for observability, security and networking. You'll see it included in various CNCF projects like Cilium, \u003ca href=\"https://github.com/falcosecurity/falco\"\u003eFalco\u003c/a\u003e, \u003ca href=\"https://www.cncf.io/projects/kepler/\"\u003eKepler\u003c/a\u003e, and others.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eWhilst BPF is powerful, it's also a very fast moving space, and was particularly complicated to patch to Firecracker's minimal Kernel configuration. We want to say a thank you to \u003ca href=\"https://twitter.com/mtardy_?lang=en\"\u003eMah√© Tardy\n\u003c/a\u003e who maintains Tetragon and to \u003ca href=\"https://www.linkedin.com/in/mauilion\"\u003eDuffie Coolie\u003c/a\u003e both from \u003ca href=\"https://isovalent.com/\"\u003eIsovalent\u003c/a\u003e for pointers and collaboration.\u003c/p\u003e\n\u003cp\u003eWe've made a big jump in the supported Kernel version from 5.10.77 up to 5.10.201, with newer revisions being made available on a continual basis.\u003c/p\u003e\n\u003cp\u003eTo update your servers, log in via SSH and edit \u003ccode\u003e/etc/default/actuated\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eFor amd64:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eAGENT_IMAGE_REF=\"ghcr.io/openfaasltd/actuated-ubuntu22.04:x86_64-latest\"\nAGENT_KERNEL_REF=\"ghcr.io/openfaasltd/actuated-kernel:x86_64-latest\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFor arm64:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eAGENT_IMAGE_REF=\"ghcr.io/openfaasltd/actuated-ubuntu22.04:aarch64-latest\"\nAGENT_KERNEL_REF=\"ghcr.io/openfaasltd/actuated-kernel:aarch64-latest\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOnce you have the new images in place, reboot the server. Updates to the Kernel and root filesystem will be delivered Over The Air (OTA) automatically by our team.\u003c/p\u003e\n\u003ch2\u003eRequest custom vCPU and RAM per job\u003c/h2\u003e\n\u003cp\u003eOur initial version of actuated aimed to set a specific vCPU and RAM value for each build, designed to slice up a machine equally for the best mix of performance and concurrency. We would recommend it to teams during their onboarding call, then mostly leave it as it was. For a machine with 128GB RAM and 32 threads, you may have set it up for 8 jobs with 4x vCPU and 16GB RAM each, or 4 jobs with 8x vCPU and 32GB RAM.\u003c/p\u003e\n\u003cp\u003eHowever, whilst working with Justin Gray, CTO at Toolpath, we found that their build needed increasing amounts of RAM to avoid an Out Of Memory (OOM) crash, and so implemented custom labels.\u003c/p\u003e\n\u003cp\u003eThese labels do not have any predetermined values, so you can change them to any value you like, independently. You're not locked into a set combinations.\u003c/p\u003e\n\u003cp\u003eSmall tasks, automation, publishing Helm charts?\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactuated-2cpu-8gb\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBuilding a large application, or training an AI model?\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactuated-32cpu-128gb\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eSpreading your plan across all available hosts\u003c/h2\u003e\n\u003cp\u003ePreviously, if you had a plan with 10 concurrent builds and both an Arm server and an amd64 server, we'd split your plan statically 50/50. So you could run a maximum of 5 Arm and 5 amd64 builds at the same time.\u003c/p\u003e\n\u003cp\u003eNow, we've made this dynamic, all of your 10 builds can start on the Arm or amd64 server. Or, 1 could start on the Arm server, then 9 on the amd64 server, and so on.\u003c/p\u003e\n\u003cp\u003eThe change makes the product better value for money, and we had always wanted it to work this way.\u003c/p\u003e\n\u003cp\u003eThanks to \u003ca href=\"https://uk.linkedin.com/in/patrickjkstephens\"\u003ePatrick Stephens at Fluent/Calyptia\u003c/a\u003e for the suggestion and for helping us test it out.\u003c/p\u003e\n\u003ch2\u003eKVM acceleration aka running VMs in your CI pipeline\u003c/h2\u003e\n\u003cp\u003eWhen we started actuated over 12 months ago, there was no support for using KVM acceleration, or running a VM within a GitHub Actions job within GitHub's infrastructure. We made it available for our customers first, with a custom Kernel configuration for \u003cem\u003ex86_64\u003c/em\u003e servers. Arm support for launching VMs within VMs is not currently available in the current generation of Ampere servers, but may be available within the next generation of chips and Kernels.\u003c/p\u003e\n\u003cp\u003eWe have several tutorials including how to run Firecracker itself within a CI job, Packer, Nix and more.\u003c/p\u003e\n\u003cp\u003eWhen you run Packer in a VM, instead of with one of the cloud drivers, you save on time and costs, by not having to fire up cloud resources on AWS, GCP, Azure, and so forth. Instead, you can run a local VM to build the image, then convert it to an AMI or another format.\u003c/p\u003e\n\u003cp\u003eOne of our customers has started exploring launching a VM during a CI job in order to test air-gapped support for enterprise customers. This is a great example of how you can use nested virtualisation to test your own product in a repeatable way.\u003c/p\u003e\n\u003cp\u003eNix benefits particularly from being able to create a clean, isolated environment within a CI pipeline, to get a repeatable build. \u003ca href=\"https://twitter.com/grhmc\"\u003eGraham Christensen\u003c/a\u003e from \u003ca href=\"https://github.com/determinateSystems/nix-installer-action\"\u003eDeterminate Systems reached out to collaborate on testing their Nix installer\u003c/a\u003e in actuated.\u003c/p\u003e\n\u003cp\u003eHe didn't expect it to run, but when it worked first time, he remarked: \"Perfect! I'm impressed and happy that our action works out of the box.\"\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003ejobs:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003especs:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eci\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003eactuated-16cpu-32gb\u003c/span\u003e]\n    \u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eDeterminateSystems/nix-installer-action@main\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\n            nix-build '\u0026#x3C;nixpkgs/nixos/tests/doas.nix\u003e'\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://actuated.dev/blog/kvm-in-github-actions\"\u003eHow to run KVM guests in your GitHub Actions\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://actuated.dev/blog/automate-packer-qemu-image-builds\"\u003eAutomate Packer Images with QEMU and Actuated\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://actuated.dev/blog/faster-nix-builds\"\u003eFaster Nix builds with GitHub Actions and actuated\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.actuated.dev/examples/kvm-guest\"\u003eDocs: Run a KVM guest\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eWrapping up\u003c/h2\u003e\n\u003cp\u003eWe've now released eBPF/BTF support as part of onboarding CNCF projects, updated to the latest Kernel revision, made scheduling better value for money \u0026#x26; easier to customise, and have added a range of tutorials for getting the most out of nested virtualisation.\u003c/p\u003e\n\u003cp\u003eIf you'd like to try out actuated, you can get started same day.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/pricing\"\u003eTalk to us.\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eYou may also like:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/blog/arm-ci-cncf-ampere\"\u003eAnnouncing managed Arm CI for CNCF projects\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.actuated.dev/\"\u003eActuated docs \u0026#x26; FAQ\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"December Boost: Custom Job Sizes, eBPF Support \u0026 KVM Acceleration","description":"You can now request custom amounts of RAM and vCPU for jobs, run eBPF within jobs, and use KVM acceleration.","tags":["ebpf","cloudnative","opensource"],"author_img":"alex","image":"/images/2023-12-scheduling-bpf/background-bpf.png","date":"2023-12-04"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"custom-sizes-bpf-kvm"},"buildId":"X_ZN51fuHqgIS_lYwh_px","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>