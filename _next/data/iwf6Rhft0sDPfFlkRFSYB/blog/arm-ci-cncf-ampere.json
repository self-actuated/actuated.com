{"pageProps":{"post":{"slug":"arm-ci-cncf-ampere","fileName":"2023-10-25-arm-ci-cncf-ampere.md","contentHtml":"<p>In this post, we'll cover why <a href=\"https://amperecomputing.com/\">Ampere Computing</a> and <a href=\"https://www.cncf.io/\">The Cloud Native Computing Foundation (CNCF)</a> are sponsoring a pilot of actuated for open source projects, how you can get involved.</p>\n<p>We'll also give you a quick one year recap on actuated, if you haven't checked in with us for a while.</p>\n<h2>Managed Arm CI for CNCF projects</h2>\n<p>At KubeCon EU, I spoke to <a href=\"https://www.linkedin.com/in/caniszczyk/\">Chris Aniszczyk</a>, CTO at the CNCF, and told him about some of the results we'd been seeing with actuated customers, including Fluent Bit, which is a CNCF project. Chris told me that many teams were either putting off Arm support all together, were suffering with the slow builds that come from using QEMU, or were managing their own infrastructure which was underutilized.</p>\n<p><a href=\"https://deploy.equinix.com/\">Equinix</a> provides a generous amount of credits to the CNCF under <a href=\"https://github.com/cncf/cluster\">CNCF Community Infrastructure Lab (CIL)</a>, including access to powerful Ampere Q80 Arm servers (<a href=\"https://deploy.equinix.com/product/servers/c3-large-arm64/\">c3.large.arm64</a>), that may at times be required by Equinix customers for their own Arm workloads.</p>\n<p>You can find out more about <a href=\"https://amperecomputing.com/products/processors\">Ampere's Altra platform here</a>, which is being branded as a \"Cloud Native\" CPU, due to its low power consumption, high core count, and ubiquitous availability across Google Cloud, Oracle Cloud Platform, Azure, Equinix Metal, Hetzner Cloud, and Alibaba Cloud.</p>\n<p>As you can imagine, over time, different projects have deployed 1-3 of their own runner servers, each with 256GB of RAM and 80 Cores, which remain idle most of the time, and are not available to other projects or Equinix customers when they may need them suddenly. So, if actuated can reduce this number, whilst also improving the experience for maintainers, then that's a win-win.</p>\n<p>Around the same time as speaking to Chris, Ampere reached out and asked how they could help secure actuated for a number of CNCF projects.</p>\n<p>Together, Ampere and the CNCF are now sponsoring an initial 1-year pilot of managed Arm CI provided by actuated, for CNCF projects, with the view to expand it, if the pilot is a success.</p>\n<p><a href=\"https://www.linkedin.com/in/edwardvielmetti/\">Ed Vielmetti</a>, Developer Partner Manager at Equinix said:</p>\n<blockquote>\n<p>I'm really happy to see this all come together. If all goes according to plan, we'll have better runner isolation, faster builds, and a smaller overall machine footprint.</p>\n</blockquote>\n<p><a href=\"https://www.linkedin.com/in/dneary/\">Dave Neary</a>, Director of Developer Relations at Ampere Computing added:</p>\n<blockquote>\n<p>Actuated offers a faster, more secure way for projects to run 64-bit Arm builds, and will also more efficiently use the Ampere Altra-based servers being used by the projects.</p>\n<p>We're happy to support CNCF projects running their CI on Ampere Computing's Cloud Native Processors, hosted by Equinix.</p>\n</blockquote>\n<h2>One year recap on actuated</h2>\n<p>In case you are hearing about actuated for the first time, I wanted to give you a quick one year recap.</p>\n<p>Just over 12 months ago, we <a href=\"https://actuated.dev/blog/blazing-fast-ci-with-microvms\">announced the work we'd been doing with actuated</a> to improve self-hosted runner security and management. We were pleasantly surprised with the amount of people that responded who'd had a common experience with slow builds, running out of RAM, limited disk space, and a lack of an easy and secure way to run self-hosted runners.</p>\n<p>Fast forward to today, and we have run over 140,000 individual Firecracker VMs for customers on their own hardware. Rather than the fully managed service that GitHub offers, we believe that you should be able to bring your own hardware, and pay a flat-rate fee for the service, rather than being charged per-minute.</p>\n<p>The CNCF project brings about 64-bit Arm support, but we see a good mix of <code>x86_64</code> and Arm builds from customers, with both closed and open-source repositories being used.</p>\n<p>The main benefits are having access to bigger, faster and more specialist hardware.</p>\n<ul>\n<li>For <code>x86_64</code> builds, we see about a 3x speed-up vs. using GitHub's hosted runners, in addition to being able to add more RAM and disk space to builds.</li>\n<li>For Arm64, we see builds which take several hours or which fail to complete within a 6 hour window using QEMU, go down to 3-5 minutes.</li>\n</ul>\n<p>Vendors and consumers are becoming increasingly aware of the importance of the supply chain, GitHub's self-hosted runner is <a href=\"https://actuated.dev/blog/is-the-self-hosted-runner-safe-github-actions\">not recommended for open source repos</a>. Why? Due to the way side-effects can be left over between builds. Actuated uses a fresh, immutable, Firecracker VM for every build which boots up in less than 1 second and is destroyed after the build completes, which removes this risk.</p>\n<p>If you're wanting to know more about why we think microVMs are the only tool that makes sense for secure CI, then I'd recommend my talk from Cloud Native Rejekts earlier in the year: <a href=\"https://www.youtube.com/watch?v=pTQ_jVYhAoc\">Face off: VMs vs. Containers vs Firecracker</a>.</p>\n<h2>What are maintainers saying?</h2>\n<p><a href=\"https://www.linkedin.com/in/ellmh\">Ellie Huxtable</a> is the maintainer of <a href=\"https://atuin.sh/\">Atuin</a>, a popular open-source tool to sync, search and backup shell history. Her Rust build for the CLI took 90 minutes with QEMU, but was reduced to just 3 minutes with actuated, and a native Arm server.</p>\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">Thanks to <a href=\"https://twitter.com/selfactuated?ref_src=twsrc%5Etfw\">@selfactuated</a>, Atuin now has very speedy ARM docker builds in our GitHub actions! Thank you <a href=\"https://twitter.com/alexellisuk?ref_src=twsrc%5Etfw\">@alexellisuk</a> üôè<br><br>Docker builds on QEMU: nearly 90 mins<br>Docker builds on ARM with Actuated: ~3 mins</p>&mdash; Ellie Huxtable (@ellie_huxtable) <a href=\"https://twitter.com/ellie_huxtable/status/1715261549172936776?ref_src=twsrc%5Etfw\">October 20, 2023</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<p>For Fluent Bit, one of their Arm builds was taking over 6 hours, which meant it always failed with a timed-out on a hosted runner. <a href=\"https://www.linkedin.com/in/patrickjkstephens/?originalSubdomain=uk\">Patrick Stephens</a>, Tech Lead of Infrastructure at Calyptia reached out to work with us. We got the time down to 5 minutes by changing <code>runs-on: ubuntu-latest</code> to <code>runs-on: actuated-arm64</code>.</p>\n<p>Patrick shares about the experience on the Calyptia blog, including the benefits to their <code>x86_64</code> builds for the commercial Calyptia product: <a href=\"https://calyptia.com/blog/scaling-builds-with-actuated\">Scaling ARM builds with Actuated</a>.</p>\n<p>A number of CNCF maintainers and community leaders such as <a href=\"https://www.linkedin.com/in/davanum/\">Davanum Srinivas (Dims)</a>, Principal Engineer at AWS have come forward with project suggestions, and we're starting to work through them, with the first two being Fluent Bit and etcd.</p>\n<p><a href=\"https://fluentbit.io/\">Fluent Bit</a> describes itself as:</p>\n<blockquote>\n<p>..a super fast, lightweight, and highly scalable logging and metrics processor and forwarder. It is the preferred choice for cloud and containerized environments.</p>\n</blockquote>\n<p><a href=\"https://etcd.io\">etcd</a> is a core component of almost every Kubernetes installation and is responsible for storing the state of the cluster.</p>\n<blockquote>\n<p>A distributed, reliable key-value store for the most critical data of a distributed system</p>\n</blockquote>\n<p>In the case of etcd, there were <a href=\"https://github.com/etcd-io/etcd/pull/16801/files#diff-b8f5f4d0db4fb959d72d74463e2fd2637feb69f6b9e1dce61ad47ee031806dbd\">two servers being maintained by five individual maintainers</a>, all of that work goes away by adopting actuated.</p>\n<p>We even sent etcd <a href=\"https://github.com/etcd-io/etcd/pull/16801\">a minimal Pull Request</a> to make the process smoother.</p>\n<p><a href=\"https://github.com/jmhbnz\">James Blair, Specialist Solution Architect at Red Hat</a>, commented:</p>\n<blockquote>\n<p>I believe managed on demand arm64 CI hosts will definitely be a big win for the project. Keen to trial this.</p>\n</blockquote>\n<p>Another maintainer also commented that they will <a href=\"https://github.com/etcd-io/etcd/pull/16801#issuecomment-1774024719\">no longer need to worry about \"leaky containers\"</a>.</p>\n<p><a href=\"https://github.com/etcd-io/etcd/actions/runs/6635037153\"><img src=\"/images/2023-10-cncf/etcd-nightly.png\" alt=\"One of the first nightly jobs running within an isolated Firecracker VM\"></a></p>\n<blockquote>\n<p>One of the first nightly workflows running within 4x separate isolated Firecracker VMs, one per job</p>\n</blockquote>\n<p>Prior to adopting actuated, the two servers were only configured to run one job at a time, afterwards, the jobs are scheduled by the control-plane, according to the amount of available RAM and CPU in the target servers.</p>\n<h2>How do we get access?</h2>\n<p>If you are working on a CNCF project and would like access, <a href=\"https://docs.google.com/forms/d/e/1FAIpQLScA12IGyVFrZtSAp2Oj24OdaSMloqARSwoxx3AZbQbs0wpGww/viewform\">please contact us via this form</a>. If your project gets selected for the pilot, there are a couple of things you may need to do.</p>\n<ol>\n<li>If you are already using the GitHub Actions runner hosted on Equinix, then change the <code>runs-on: self-hosted</code> label to: <code>runs-on: actuated-arm64-8cpu-16gb</code>. Then after you've seen a build or two pass, delete the old runner.</li>\n<li>If you are using QEMU, the best next step is to \"split\" the build into two jobs which can run on <code>x86_64</code> and <code>arm64</code> natively, that's what Ellie did and it only took her a few minutes.</li>\n</ol>\n<p>The label for <code>runs-on:</code> allows for dynamic configuration of vCPU and GBs of RAM, just edit the label to match your needs, for etcd, the team asked for 8vCPU and 32GB of RAM, so they used <code>runs-on: actuated-arm64-8cpu-32gb</code>.</p>\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">I had to split the docker build so that the ARM half would build on ARM, and x86 on x86, and then a step to combine the two - overall this works out to be a very significant improvement<a href=\"https://t.co/69cIxjYRcW\">https://t.co/69cIxjYRcW</a></p>&mdash; Ellie Huxtable (@ellie_huxtable) <a href=\"https://twitter.com/ellie_huxtable/status/1715266936592904446?ref_src=twsrc%5Etfw\">October 20, 2023</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<p>We have full instructions for 2, in the following tutorial: <a href=\"https://actuated.dev/blog/how-to-run-multi-arch-builds-natively\">How to split up multi-arch Docker builds to run natively</a>.</p>\n<h2>Learn more about actuated</h2>\n<p>We're initially offering access to managed Arm CI for CNCF projects, but if you're working for a company that is experiencing friction with CI, <a href=\"https://docs.google.com/forms/d/e/1FAIpQLScA12IGyVFrZtSAp2Oj24OdaSMloqARSwoxx3AZbQbs0wpGww/viewform\">please reach out to us to talk</a>.</p>\n<ul>\n<li>Read one of our <a href=\"https://actuated.dev/blog\">recent blog posts</a></li>\n<li>Learn more about <a href=\"https://docs.actuated.dev\">actuated in the docs</a></li>\n<li><a href=\"https://actuated.dev\">Read what our customers are saying about our service</a></li>\n</ul>\n<blockquote>\n<p>Did you know? <a href=\"https://actuated.dev/blog/secure-microvm-ci-gitlab\">Actuated for GitLab CI is now in technical preview, watch a demo here</a>.</p>\n</blockquote>","title":"Announcing managed Arm CI for CNCF projects","description":"Ampere Computing and The Cloud Native Computing Foundation are sponsoring a pilot of actuated's managed Arm CI for CNCF projects.","tags":["cloudnative","arm","opensource"],"author_img":"alex","image":"/images/2023-10-cncf/background.png","date":"2023-10-25"}},"__N_SSG":true}